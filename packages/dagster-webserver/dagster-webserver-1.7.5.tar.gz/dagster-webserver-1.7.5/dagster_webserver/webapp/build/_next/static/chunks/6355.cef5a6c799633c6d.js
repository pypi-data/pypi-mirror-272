"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6355],{36355:function(e,n,t){t.r(n),t.d(n,{RunRoot:function(){return RunRoot},default:function(){return eE}});var i=t(73235),o=t(52322),r=t(40794),s=t(89130),a=t(18399),u=t(17131),l=t(81308),c=t(3842),d=t(57830),p=t(92364),f=t(2784),m=t(7267),g=t(51892),x=t(85333),h=t(6692),v=t(58467),y=t(82550),j=t(64595),S=t(43180),R=t(9001),T=t(67486),b=t(10735),_=t(25195),I=t(35505),w=t(40157),O=t(96956),C=t(27124),N=t(56307),k=t(72205),L=t(95388),E=t(63650),F=t(51332),A=t(53068),K=t(52623),z=t(66904),D=t(82329),J=t(56266),Q=t(35157),P=t(84692),V=t(18960),U=t(61935),q=t(28252),useFavicon=function(e){(0,f.useEffect)(function(){var n=document.querySelector('link[rel="icon"][type="image/svg+xml"]');if(n){var t=n.getAttribute("href");return n.setAttribute("href",e),function(){t&&n.setAttribute("href",t)}}},[e])},H=t(71277),M=t(502),W=t(60731);function _templateObject(){var e=(0,i._)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n"]);return _templateObject=function(){return e},e}var runStatusFavicon=function(e){switch(e){case U.VOA.FAILURE:return"/favicon-run-failed.svg";case U.VOA.SUCCESS:return"/favicon-run-success.svg";case U.VOA.STARTING:case U.VOA.STARTED:case U.VOA.CANCELING:return"/favicon-run-pending.svg";default:return"/favicon.svg"}},B=(0,f.memo)(function(e){var n=e.run,t=e.runId,i=e.trace,r=(0,v._)((0,K.Bz)(),2),s=r[0],a=r[1],u=(0,v._)((0,H.q)({queryKey:"selection",defaults:{selection:""}}),2),l=u[0],c=u[1];useFavicon(n?runStatusFavicon(n.status):"/favicon.svg"),(0,q.j)(n?"".concat((0,Q.pv)(n.pipelineName)?"":n.pipelineName," ").concat(t.slice(0,8)," [").concat(n.status,"]"):"Run: ".concat(t));var onShowStateDetails=function(e,n){var t=n.find(function(n){return"ExecutionStepFailureEvent"===n.__typename&&n.stepKey===e});t&&(0,z._K)({body:(0,o.jsx)(J.T9,{error:t})})},onSetSelectionQuery=function(e){c(e),a((0,h._)((0,x._)({},s),{logQuery:"*"!==e?[{token:"query",value:e}]:[]}))},d=(0,W.FE)("RunLogs");return(0,o.jsx)(E.A.Provider,{value:n,children:(0,o.jsx)(C.C,{runId:t,children:function(e){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(OnLogsLoaded,{trace:i,dependency:d}),(0,o.jsx)(F.jp,{logs:e,children:function(i){return(0,o.jsx)(RunWithData,{run:n,runId:t,logs:e,logsFilter:s,metadata:i,selectionQuery:l,onSetLogsFilter:a,onSetSelectionQuery:onSetSelectionQuery,onShowStateDetails:onShowStateDetails})}})]})}},t)})}),OnLogsLoaded=function(e){var n=e.trace,t=e.dependency;return f.useLayoutEffect(function(){n.onLogsLoaded(),t.completeDependency(W.Os.SUCCESS)},[t,n]),null},logTypeFromQuery=function(e){switch(e){case"stdout":return k.hi.stdout;case"stderr":return k.hi.stderr;default:return k.hi.structured}},RunWithData=function(e){var n=e.run,t=e.runId,i=e.logs,r=e.logsFilter,s=e.metadata,u=e.selectionQuery,l=e.onSetLogsFilter,c=e.onSetSelectionQuery,d=(0,v._)((0,H.q)({queryKey:"logType",defaults:{logType:k.hi.structured}}),2),m=d[0],g=d[1],x=logTypeFromQuery(m),h=(0,v._)(f.useState(null),2),_=h[0],I=h[1],C=JSON.stringify(Object.keys(s.steps).sort()),E=f.useMemo(function(){return JSON.parse(C)},[C]),F=(null==n?void 0:n.executionPlan)&&(0,V.J)(null==n?void 0:n.executionPlan,s.steps),K=f.useMemo(function(){return F&&u&&"*"!==u?(0,D.V)(F,u).all.map(function(e){return e.name}):[]},[F,u]),z=(0,M.a)(),J=(0,A.r)({stepKeys:E,selectionStepKeys:K,metadata:s,defaultToFirstStep:!1}),Q=J.logCaptureInfo,U=J.computeLogFileKey,q=J.setComputeLogFileKey,W=F?r.logQuery.filter(function(e){return e.token&&"query"===e.token}).reduce(function(e,n){return(0,y._)(e).concat((0,y._)((0,D.V)(F,n.value).all.map(function(e){return e.name})))},[]):[],B=(0,v._)(f.useState(null),2),Z=B[0],$=B[1],G=f.useRef(null);f.useEffect(function(){if(G.current){var e=G.current.getSize();100===e?$("top"):0===e&&$("bottom")}},[]);var X="top"===Z,ee="bottom"===Z,resetPanels=function(){var e;null===(e=G.current)||void 0===e||e.changeSize(50),$(null)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(b.O,{ref:G,axis:"vertical",identifier:"run-gantt",firstInitialPercent:35,firstMinSize:56,first:n?"QUEUED"===n.status?(0,o.jsx)(P.Fu,{run:n}):n.executionPlan&&F?(0,o.jsx)(j.S,{region:"gantt chart",children:(0,o.jsx)(P.hj,{options:{mode:P.hS.WATERFALL_TIMED},toolbarActions:(0,o.jsxs)(a.x,{flex:{direction:"row",alignItems:"center",gap:12},children:[(0,o.jsx)(S.u,{content:X?"Collapse":"Expand",children:(0,o.jsx)(R.zx,{icon:(0,o.jsx)(T.JO,{name:X?"collapse_arrows":"expand_arrows"}),onClick:X?resetPanels:function(){var e;null===(e=G.current)||void 0===e||e.changeSize(100),$("top")}})}),(0,o.jsx)(L.NX,{run:n,graph:F,metadata:s,selection:{query:u,keys:K}})]}),runId:t,graph:F,metadata:s,selection:{query:u,keys:K},onClickStep:function(e,n){var t,i=K.indexOf(e),o='"'.concat(e,'"');if(n.shiftKey)t=(0,y._)(K.map(function(e){return u.includes('"'.concat(e,'"'))?'"'.concat(e,'"'):e})),-1!==i?t.splice(i,1):t.push(o);else if(1===K.length&&-1!==i)t=[];else{t=[o];var r=(0,A.c)(s.logCaptureSteps,e);r&&q(r)}c(t.join(", ")||"*")},onSetSelection:c,focusedTime:r.focusedTime})}):(0,o.jsx)(p.t,{icon:"error",title:"Unable to build execution plan"}):(0,o.jsx)(P.ZW,{runId:t}),secondMinSize:56,second:(0,o.jsx)(j.S,{region:"logs",children:(0,o.jsxs)(Y,{children:[(0,o.jsx)(k.KZ,{logType:x,onSetLogType:function(e){return g(k.hi[e])},filter:r,onSetFilter:l,steps:E,metadata:s,computeLogFileKey:U,onSetComputeLogKey:q,computeLogUrl:_,counts:i.counts,isSectionExpanded:ee,toggleExpanded:ee?resetPanels:function(){var e;null===(e=G.current)||void 0===e||e.changeSize(0),$("bottom")}}),x!==k.hi.structured?U?z?(0,o.jsx)(w.h,{logKey:U?[t,"compute_logs",U]:[],logCaptureInfo:Q,visibleIOType:k.hi[x],onSetDownloadUrl:I}):(0,o.jsx)(O.K,{runId:t,computeLogFileKey:E.length?U:void 0,ioType:k.hi[x],setComputeLogUrl:I}):(0,o.jsx)(NoStepSelectionState,{type:x}):(0,o.jsx)(N.S,{logs:i,filter:r,filterStepKeys:W,filterKey:"".concat(JSON.stringify(r)),metadata:s})]})})})})},Y=I.ZP.div.withConfig({componentId:"sc-d1a6912f-0"})(_templateObject()),NoStepSelectionState=function(e){var n=e.type;return(0,o.jsx)(a.x,{flex:{direction:"row",grow:1,alignItems:"center",justifyContent:"center"},style:{background:_.v8()},children:(0,o.jsx)(p.t,{title:"Select a step to view ".concat(n),icon:"warning",description:"Select a step on the Gantt chart or from the dropdown above to view logs."})})};function RunAssetTags_templateObject(){var e=(0,i._)(["\n  query RunAssetsQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        assets {\n          id\n          key {\n            path\n          }\n        }\n      }\n    }\n  }\n"]);return RunAssetTags_templateObject=function(){return e},e}var RunAssetTags=function(e){var n=e.run,t=(0,Q.pv)(n.pipelineName),i=(0,r.a)(Z,{variables:{runId:n.id},skip:t}),s=i.data,a=i.loading;return((0,W.Hu)(i,"RunAssetsQuery",{skip:t}),a||!s||"Run"!==s.pipelineRunOrError.__typename)?null:(0,o.jsx)(g.h,{useTags:!0,assetKeys:s.pipelineRunOrError.assets.map(function(e){return e.key})})},Z=(0,s.Ps)(RunAssetTags_templateObject()),$=t(91916),G=t(81862),X=t(87612),ee=t(22970),en=t(33379),et=t(59692),ei=t(37783),eo=t(44678),er=t(16530),es=t(77034),ea=t(6315),eu=t(38917),el=t(16322),ec=t(34263),ed=t(19211),ep=t(47544),ef=t(85502),em=t(16148),eg=t(38153),RunHeaderActions=function(e){var n,t,i,r,s=e.run,a=e.isJob,u=s.runConfigYaml,l=(0,v._)((0,f.useState)(null),2),c=l[0],d=l[1],p=(0,f.useContext)(ec.I).rootServerURI,g=(0,f.useContext)(eu.Lw).refetch,x=(0,ep.m)(),h=(0,m.k6)(),y=(0,v._)((0,en.D)(ef.FREE_CONCURRENCY_SLOTS_MUTATION),1)[0],j=(n=(0,G._)(function(){return(0,ee.Jh)(this,function(e){switch(e.label){case 0:return x(u),[4,(0,ed.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Copied!"})];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)}),b=(t=(0,G._)(function(){var e;return(0,ee.Jh)(this,function(n){switch(n.label){case 0:return[4,y({variables:{runId:s.id}})];case 1:if(!(null===(e=n.sent().data)||void 0===e?void 0:e.freeConcurrencySlots))return[3,3];return[4,(0,ed.B7)({intent:"success",icon:"check_circle",message:"Freed concurrency slots"})];case 2:n.sent(),n.label=3;case 3:return[2]}})}),function(){return t.apply(this,arguments)}),_=(0,eg.$y)({repositoryName:null===(i=s.repositoryOrigin)||void 0===i?void 0:i.repositoryName,repositoryLocationName:null===(r=s.repositoryOrigin)||void 0===r?void 0:r.repositoryLocationName,run:s,isJob:a});return(0,o.jsxs)("div",{children:[(0,o.jsxs)(et.Z,{direction:"row",spacing:8,children:[_.disabledReason?(0,o.jsx)(S.u,{content:_.disabledReason,useDisabledButtonTooltipFix:!0,children:(0,o.jsx)(R.zx,{icon:(0,o.jsx)(T.JO,{name:_.icon}),disabled:!0,children:_.label})}):(0,o.jsx)(em.A,{icon:(0,o.jsx)(T.JO,{name:_.icon}),to:_.to,children:_.label}),(0,o.jsx)(R.zx,{icon:(0,o.jsx)(T.JO,{name:"tag"}),onClick:function(){return d("config")},children:"View tags and config"}),(0,o.jsx)(ei.J,{position:"bottom-right",content:(0,o.jsxs)(eo.v2,{children:[(0,o.jsx)(S.u,{content:"Loadable in dagster-webserver-debug",position:"left",targetTagName:"div",children:(0,o.jsx)(eo.sN,{text:"Download debug file",icon:"download_for_offline",onClick:function(){return window.open("".concat(p,"/download_debug/").concat(s.id))}})}),s.hasConcurrencyKeySlots&&ea.cv.has(s.status)?(0,o.jsx)(eo.sN,{text:"Free concurrency slots",icon:"lock",onClick:b}):null,s.hasDeletePermission?(0,o.jsx)(eo.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:function(){return d("delete")}}):null]}),children:(0,o.jsx)(R.zx,{icon:(0,o.jsx)(T.JO,{name:"expand_more"})})})]}),(0,o.jsx)(es.U,{isOpen:"config"===c,onClose:function(){return d(null)},copyConfig:function(){return j()},mode:s.mode,runConfigYaml:s.runConfigYaml,tags:s.tags,isJob:a}),s.hasDeletePermission?(0,o.jsx)(er.N,{isOpen:"delete"===c,onClose:function(){return d(null)},onComplete:function(){s.repositoryOrigin?h.push((0,eg.jT)({repoName:s.repositoryOrigin.repositoryName,repoLocation:s.repositoryOrigin.repositoryLocationName,pipelineName:s.pipelineName,isJob:a,path:"/runs"})):d(null)},onTerminateInstead:function(){return d("terminate")},selectedRuns:(0,X._)({},s.id,s.canTerminate)}):null,s.hasTerminatePermission?(0,o.jsx)(el.A,{isOpen:"terminate"===c,onClose:function(){return d(null)},onComplete:function(){g()},selectedRuns:(0,X._)({},s.id,s.canTerminate)}):null]})},ex=t(83568),useRunRootTrace=function(){var e=(0,ex.se)("RunRoot");return(0,f.useMemo)(function(){var n=!1,t=!1;function onLoaded(){n&&t&&e.endTrace()}return{onLogsLoaded:function(){n=!0,onLoaded()},onRunLoaded:function(){t=!0,onLoaded()}}},[e])},eh=t(87424),ev=t(84495),ey=t(76487),ej=t(46032),eS=t(30301),RunTimingTags=function(e){var n=e.loading,t=e.run;return(0,o.jsxs)(o.Fragment,{children:[(null==t?void 0:t.startTime)?(0,o.jsx)(ei.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(a.x,{padding:16,children:(0,o.jsx)(ey.s9,{run:t,loading:n})}),children:(0,o.jsx)(d.V,{icon:"schedule",children:(0,o.jsx)(eS.v,{timestamp:t.startTime,timeFormat:{showSeconds:!0,showTimezone:!1}})})}):t.updateTime?(0,o.jsx)(d.V,{icon:"schedule",children:(0,o.jsx)(eS.v,{timestamp:t.updateTime,timeFormat:{showSeconds:!0,showTimezone:!1}})}):void 0,(null==t?void 0:t.startTime)&&(null==t?void 0:t.endTime)?(0,o.jsx)(ei.J,{interactionKind:"hover",placement:"bottom",content:(0,o.jsx)(a.x,{padding:16,children:(0,o.jsx)(ey.s9,{run:t,loading:n})}),children:(0,o.jsx)(d.V,{icon:"timer",children:(0,o.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:(null==t?void 0:t.startTime)?(0,ej.R4)(((null==t?void 0:t.endTime)*1e3||Date.now())-(null==t?void 0:t.startTime)*1e3):"–"})})}):null]})},eR=t(12084),eT=t(16861),eb=t(32911),TickTagForRun=function(e){var n=e.instigationSelector,t=e.instigationType,i=e.tickId,r=(0,v._)((0,f.useState)(!1),2),s=r[0],a=r[1],u=t===ev.H.ScheduleName?"schedule":"sensors",l=n.name;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.V,{icon:u,children:(0,o.jsxs)("span",{children:["Launched by"," ",(0,o.jsx)(eR.Z,{onClick:function(){return a(!0)},children:(0,o.jsx)("div",{style:{maxWidth:"140px"},children:(0,o.jsx)(eT.g,{text:l})})})]})}),(0,o.jsx)(eb.X,{isOpen:s,onClose:function(){return a(!1)},instigationSelector:n,tickId:Number(i)})]})},e_=t(68028),eI=t(47933),ew=t(74711),eO=new Intl.Collator(navigator.language,{sensitivity:"base"}),AutomaterializeTagWithEvaluation=function(e){var n=e.assetKeys,t=e.evaluationId,i=(0,f.useMemo)(function(){return(0,y._)(n).sort(function(e,n){return eO.compare(e.path.join("/"),n.path.join("/"))})},[n]);return(0,o.jsx)(ei.J,{placement:"bottom",content:(0,o.jsxs)("div",{style:{width:"340px"},children:[(0,o.jsx)(a.x,{padding:{vertical:8,horizontal:12},border:"bottom",style:{fontWeight:600},children:"Auto-materialized"}),(0,o.jsx)(a.x,{flex:{direction:"column",gap:12},padding:{vertical:12},style:{maxHeight:"220px",overflowY:"auto"},children:i.map(function(e){var n=(0,ew.p)(e,{view:"automation",evaluation:t});return(0,o.jsxs)(a.x,{padding:{vertical:8,left:12,right:16},flex:{direction:"row",justifyContent:"space-between",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsxs)(a.x,{flex:{direction:"row",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,o.jsx)(T.JO,{name:"asset"}),(0,o.jsx)(eT.g,{text:e.path.join("/")})]}),(0,o.jsx)(eI.rU,{to:n,style:{whiteSpace:"nowrap"},children:"View evaluation"})]},n)})})]}),interactionKind:"hover",children:(0,o.jsx)(d.V,{icon:"auto_materialize_policy",children:"Auto-materialized"})})},eC=t(90818),eN=t(46988),ek=t(37160),eL=t(26997);function RunRoot_templateObject(){var e=(0,i._)(["\n  query RunRootQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        ...RunPageFragment\n      }\n    }\n  }\n\n  ","\n"]);return RunRoot_templateObject=function(){return e},e}var RunRoot=function(){(0,e_.Px)();var e,n=useRunRootTrace(),t=(0,m.UO)().runId;(0,q.j)(t?"Run ".concat(t.slice(0,8)):"Run");var i=(0,r.a)(eF,{variables:{runId:t}}),s=i.data,p=i.loading;(0,W.Hu)(i,"RunRootQuery");var x=(null==s?void 0:s.pipelineRunOrError.__typename)==="Run"?s.pipelineRunOrError:null,h=null==x?void 0:x.pipelineSnapshotId,v=(0,eL.n)(x),y=(null==v?void 0:v.match)?(0,ek.kQ)(v.match.repository.name,v.match.repositoryLocation.name):null,j=(0,f.useMemo)(function(){return!!(x&&v&&(0,eN.E8)(v.match,x.pipelineName))},[x,v]),S=(0,f.useMemo)(function(){return(null==x?void 0:x.tags.find(function(e){return e.key===ev.H.AssetEvaluationID}))||null},[x]);(0,f.useLayoutEffect)(function(){p||n.onRunLoaded()},[p,n]);var R=(0,f.useMemo)(function(){if(y){var e=(null==x?void 0:x.tags)||[],n=e.find(function(e){return e.key===ev.H.TickId});if(n){var t=e.find(function(e){return e.key===ev.H.ScheduleName||e.key===ev.H.SensorName});if(t){var i={name:t.value,repositoryName:y.name,repositoryLocationName:y.location};return{tickId:n.value,instigationType:t.key,instigationSelector:i}}}}return null},[x,y]);return(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,o.jsx)(a.x,{flex:{direction:"row",alignItems:"flex-start"},style:{position:"relative",zIndex:1},children:(0,o.jsx)(u.m,{title:(0,o.jsx)(l.X6,{style:{fontFamily:c.b.monospace,fontSize:"16px"},children:t.slice(0,8)}),tags:x?(0,o.jsxs)(a.x,{flex:{direction:"row",alignItems:"flex-start",gap:12,wrap:"wrap"},children:[(0,o.jsx)(eh.KG,{status:x.status}),(0,Q.pv)(x.pipelineName)?null:(0,o.jsxs)(d.V,{icon:"run",children:["Run of"," ",(0,o.jsx)(eC.h,{pipelineName:null==x?void 0:x.pipelineName,pipelineHrefContext:y||"repo-unknown",snapshotId:h,size:"small",isJob:j})]}),R?(0,o.jsx)(TickTagForRun,{instigationSelector:R.instigationSelector,instigationType:R.instigationType,tickId:R.tickId}):null,(0,Q.pv)(x.pipelineName)?(0,o.jsx)(g.h,{useTags:!0,assetKeys:(0,eu.Bo)(x)}):(0,o.jsx)(RunAssetTags,{run:x}),(0,o.jsx)(g.m,{useTags:!0,assetChecks:x.assetCheckSelection}),(0,o.jsx)(RunTimingTags,{run:x,loading:p}),S&&(null===(e=x.assetSelection)||void 0===e?void 0:e.length)?(0,o.jsx)(AutomaterializeTagWithEvaluation,{assetKeys:x.assetSelection,evaluationId:S.value}):null]}):null,right:x?(0,o.jsx)(RunHeaderActions,{run:x,isJob:j}):null})}),(0,o.jsx)(RunById,{data:s,runId:t,trace:n})]})},eE=RunRoot,RunById=function(e){var n=e.data,t=e.runId,i=e.trace;return n&&n.pipelineRunOrError?"Run"!==n.pipelineRunOrError.__typename?(0,o.jsx)(a.x,{padding:{vertical:64},children:(0,o.jsx)(p.t,{icon:"error",title:"No run found",description:"The run with this ID does not exist or has been cleaned up."})}):(0,o.jsx)(B,{run:n.pipelineRunOrError,runId:t,trace:i}):(0,o.jsx)(B,{run:void 0,runId:t,trace:i})},eF=(0,s.Ps)(RunRoot_templateObject(),$.tQ)}}]);
//# sourceMappingURL=6355.cef5a6c799633c6d.js.map