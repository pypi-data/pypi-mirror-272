"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5502,4120],{85502:function(n,e,t){t.r(e),t.d(e,{ConcurrencyLimits:function(){return ConcurrencyLimits},FREE_CONCURRENCY_SLOTS_MUTATION:function(){return nu},INSTANCE_CONCURRENCY_LIMITS_QUERY:function(){return ni},InstanceConcurrencyPage:function(){return InstanceConcurrencyPage},InstanceConcurrencyPageContent:function(){return nn},RunConcurrencyContent:function(){return RunConcurrencyContent},default:function(){return ne}});var r=t(81862),c=t(58467),i=t(73235),o=t(82550),s=t(22970),u=t(52322),l=t(40794),a=t(33379),d=t(89130),y=t(18399),x=t(63832),m=t(28888),p=t(17131),h=t(81308),j=t(95223),f=t(94092),g=t(9001),C=t(67486),b=t(92364),v=t(12084),_=t(57830),S=t(10952),I=t(34822),K=t(37783),O=t(44678),L=t(43180),R=t(25195),T=t(54266),k=t(2784),w=t(47933),E=t(74897),q=t(4120),N=t(83601),D=t(88510),F=t(35505),V=t(55237),P=t(55658),Q=t(41256);function _templateObject(){var n=(0,i._)(["\n  query SingleConcurrencyKeyQuery($concurrencyKey: String!) {\n    instance {\n      id\n      concurrencyLimit(concurrencyKey: $concurrencyKey) {\n        concurrencyKey\n        slotCount\n        claimedSlots {\n          runId\n          stepKey\n        }\n        pendingSteps {\n          runId\n          stepKey\n          enqueuedTimestamp\n          assignedTimestamp\n          priority\n        }\n      }\n    }\n  }\n"]);return _templateObject=function(){return n},n}function _templateObject1(){var n=(0,i._)(["\n  display: grid;\n  grid-template-columns: ",";\n  height: 100%;\n"]);return _templateObject1=function(){return n},n}var $="1fr 150px 150px 150px 150px 150px",ConcurrencyTable=function(n){var e=n.concurrencyKeys,t=n.onEdit,r=n.onDelete,c=n.onSelect,i=(0,k.useRef)(null),o=(0,D.MG)({count:e.length,getScrollElement:function(){return i.current},estimateSize:function(){return 64},overscan:10}),s=o.getTotalSize(),l=o.getVirtualItems();return(0,u.jsx)("div",{style:{overflow:"hidden"},children:(0,u.jsxs)(P.W2,{ref:i,children:[(0,u.jsx)(ConcurrencyHeader,{}),(0,u.jsx)(P.Nh,{$totalHeight:s,children:l.map(function(n){var i=n.index,o=n.key,s=n.size,l=n.start,a=e[i];return(0,u.jsx)(ConcurrencyRow,{concurrencyKey:a,onEdit:t,onDelete:r,onSelect:c,height:s,start:l},o)})})]})})},ConcurrencyHeader=function(){return(0,u.jsxs)(P.VJ,{templateColumns:$,sticky:!0,children:[(0,u.jsx)(P.qN,{children:"Concurrency key"}),(0,u.jsx)(P.qN,{children:"Total slots"}),(0,u.jsx)(P.qN,{children:"Assigned steps"}),(0,u.jsx)(P.qN,{children:"Pending steps"}),(0,u.jsx)(P.qN,{children:"All steps"}),(0,u.jsx)(P.qN,{})]})},ConcurrencyRow=function(n){var e=n.concurrencyKey,t=n.onEdit,r=n.onDelete,i=n.onSelect,o=n.height,s=n.start,l=(0,c._)((0,N.t)(z,{variables:{concurrencyKey:e}}),2),a=l[0],d=l[1];(0,Q.v5)(a),(0,V.C4)(d,V.dT);var x=d.data,m=null==x?void 0:x.instance.concurrencyLimit;return(0,u.jsx)(P.X2,{$height:o,$start:s,children:(0,u.jsxs)(A,{border:"bottom",children:[(0,u.jsx)(P.E5,{children:(0,u.jsx)(u.Fragment,{children:e})}),(0,u.jsx)(P.E5,{children:m?(0,u.jsx)("div",{children:m.slotCount}):(0,u.jsx)(Q.mq,{queryResult:d})}),(0,u.jsx)(P.E5,{children:m?(0,u.jsx)(u.Fragment,{children:m.pendingSteps.filter(function(n){return!!n.assignedTimestamp}).length}):(0,u.jsx)(Q.mq,{queryResult:d})}),(0,u.jsx)(P.E5,{children:m?(0,u.jsx)(u.Fragment,{children:m.pendingSteps.filter(function(n){return!n.assignedTimestamp}).length}):(0,u.jsx)(Q.mq,{queryResult:d})}),(0,u.jsx)(P.E5,{children:m?(0,u.jsxs)(y.x,{flex:{direction:"row",gap:16,alignItems:"center"},children:[(0,u.jsx)("span",{children:m.pendingSteps.length}),(0,u.jsx)(_.V,{intent:"primary",interactive:!0,children:(0,u.jsx)(v.Z,{onClick:function(){i(m.concurrencyKey)},children:"View all"})})]}):(0,u.jsx)(Q.mq,{queryResult:d})}),(0,u.jsx)(P.E5,{children:(0,u.jsx)(ConcurrencyLimitActionMenu,{concurrencyKey:e,onEdit:t,onDelete:r})})]})})},ConcurrencyLimitActionMenu=function(n){var e=n.concurrencyKey,t=n.onDelete,r=n.onEdit;return(0,u.jsx)(K.J,{content:(0,u.jsxs)(O.v2,{children:[(0,u.jsx)(O.sN,{icon:"edit",text:"Edit",onClick:function(){return r(e)}}),(0,u.jsx)(O.sN,{icon:"delete",intent:"danger",text:"Delete",onClick:function(){return t(e)}})]}),position:"bottom-left",children:(0,u.jsx)(g.zx,{icon:(0,u.jsx)(C.JO,{name:"expand_more"})})})},z=(0,d.Ps)(_templateObject()),A=(0,F.ZP)(y.x).withConfig({componentId:"sc-15dcea62-0"})(_templateObject1(),$),U=t(19211),J=t(46032),H=t(68028),M=t(28252),Y=t(71277),B=t(60731),Z=t(21485),W=t(6315),G=t(38917),X=t(88846);function InstanceConcurrency_templateObject(){var n=(0,i._)(["\n  fragment ConcurrencyStepFragment on PendingConcurrencyStep {\n    runId\n    stepKey\n    enqueuedTimestamp\n    assignedTimestamp\n    priority\n  }\n"]);return InstanceConcurrency_templateObject=function(){return n},n}function InstanceConcurrency_templateObject1(){var n=(0,i._)(["\n  fragment ConcurrencyLimitFragment on ConcurrencyKeyInfo {\n    concurrencyKey\n    slotCount\n    claimedSlots {\n      runId\n      stepKey\n    }\n    pendingSteps {\n      ...ConcurrencyStepFragment\n    }\n  }\n  ","\n"]);return InstanceConcurrency_templateObject1=function(){return n},n}function _templateObject2(){var n=(0,i._)(["\n  fragment RunQueueConfigFragment on RunQueueConfig {\n    maxConcurrentRuns\n    tagConcurrencyLimitsYaml\n  }\n"]);return _templateObject2=function(){return n},n}function _templateObject3(){var n=(0,i._)(["\n  query InstanceConcurrencyLimitsQuery {\n    instance {\n      id\n      info\n      supportsConcurrencyLimits\n      runQueuingSupported\n      runQueueConfig {\n        ...RunQueueConfigFragment\n      }\n      minConcurrencyLimitValue\n      maxConcurrencyLimitValue\n      concurrencyLimits {\n        concurrencyKey\n      }\n    }\n  }\n\n  ","\n"]);return _templateObject3=function(){return n},n}function _templateObject4(){var n=(0,i._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return _templateObject4=function(){return n},n}function _templateObject5(){var n=(0,i._)(["\n  mutation DeleteConcurrencyLimit($concurrencyKey: String!) {\n    deleteConcurrencyLimit(concurrencyKey: $concurrencyKey)\n  }\n"]);return _templateObject5=function(){return n},n}function _templateObject6(){var n=(0,i._)(["\n  mutation FreeConcurrencySlots($runId: String!, $stepKey: String) {\n    freeConcurrencySlots(runId: $runId, stepKey: $stepKey)\n  }\n"]);return _templateObject6=function(){return n},n}function _templateObject7(){var n=(0,i._)(["\n  query ConcurrencyKeyDetailsQuery($concurrencyKey: String!) {\n    instance {\n      id\n      concurrencyLimit(concurrencyKey: $concurrencyKey) {\n        ...ConcurrencyLimitFragment\n      }\n    }\n  }\n  ","\n"]);return _templateObject7=function(){return n},n}function _templateObject8(){var n=(0,i._)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          status\n        }\n      }\n    }\n  }\n"]);return _templateObject8=function(){return n},n}var nn=k.memo(function(){(0,H.Px)(),(0,M.j)("Concurrency");var n=(0,c._)((0,Y.q)({queryKey:"key"}),2),e=n[0],t=n[1],r=(0,l.a)(ni,{notifyOnNetworkStatusChange:!0}),i=(0,V.C4)(r,V.dT),o=r.data;return(0,u.jsx)("div",{style:{overflowY:"auto"},children:o?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(y.x,{margin:{bottom:64},children:(0,u.jsx)(RunConcurrencyContent,{refreshState:i,hasRunQueue:!!(null==o?void 0:o.instance.runQueuingSupported),runQueueConfig:null==o?void 0:o.instance.runQueueConfig})}),(0,u.jsx)(ConcurrencyLimits,{instanceConfig:o.instance.info,concurrencyKeys:o.instance.concurrencyLimits.map(function(n){return n.concurrencyKey}),hasSupport:o.instance.supportsConcurrencyLimits,refetch:r.refetch,minValue:o.instance.minConcurrencyLimitValue,maxValue:o.instance.maxConcurrencyLimitValue,selectedKey:e,onSelectKey:t})]}):(0,u.jsx)(y.x,{padding:{vertical:64},children:(0,u.jsx)(x.$,{purpose:"section"})})})}),InstanceConcurrencyPage=function(){var n=k.useContext(E.N).pageTitle;return(0,u.jsxs)(m.T,{children:[(0,u.jsx)(p.m,{title:(0,u.jsx)(h.X6,{children:n}),tabs:(0,u.jsx)(q.Z,{tab:"concurrency"})}),(0,u.jsx)(nn,{})]})},ne=InstanceConcurrencyPage,RunConcurrencyContent=function(n){var e=n.hasRunQueue,t=n.runQueueConfig,r=n.onEdit,c=n.refreshState;if(!e)return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(y.x,{padding:{vertical:16,horizontal:24},border:"bottom",flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:[(0,u.jsx)(h.pm,{children:"Run concurrency"}),c?(0,u.jsx)(V.xi,{refreshState:c}):null]}),(0,u.jsxs)(y.x,{padding:{vertical:16,horizontal:24},children:["Run concurrency is not supported with this run coordinator. To enable run concurrency limits, configure your instance to use the ",(0,u.jsx)(h.fv,{children:"QueuedRunCoordinator"})," in your"," ",(0,u.jsx)(h.fv,{children:"dagster.yaml"}),". See the"," ",(0,u.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/deployment/dagster-instance#queuedruncoordinator",children:"QueuedRunCoordinator documentation"})," ","for more information."]})]});var i=(0,u.jsxs)(y.x,{padding:{vertical:16,horizontal:24},children:["Run concurrency can be set in your run queue settings. See the"," ",(0,u.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/guides/limiting-concurrency-in-data-pipelines#configuring-run-level-concurrency",children:"run concurrency documentation"})," ","for more information."]}),o=t?(0,u.jsx)(j.fJ,{children:(0,u.jsxs)("tbody",{children:[(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:"Max concurrent runs:"}),(0,u.jsx)("td",{children:t.maxConcurrentRuns})]}),(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:"Tag concurrency limits:"}),(0,u.jsx)("td",{children:t.tagConcurrencyLimitsYaml?(0,u.jsx)(f.u,{value:t.tagConcurrencyLimitsYaml,options:{readOnly:!0,lineNumbers:!0,mode:"yaml"}}):"-"})]})]})}):null;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(RunConcurrencyLimitHeader,{onEdit:r,refreshState:c}),i,o]})},RunConcurrencyLimitHeader=function(n){var e=n.onEdit,t=n.refreshState;return(0,u.jsxs)(y.x,{flex:{justifyContent:"space-between",alignItems:"center"},padding:{vertical:16,horizontal:24},border:"bottom",children:[(0,u.jsx)(h.pm,{children:"Run concurrency"}),(0,u.jsxs)(y.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[t?(0,u.jsx)(V.xi,{refreshState:t}):null,e?(0,u.jsx)(g.zx,{icon:(0,u.jsx)(C.JO,{name:"edit"}),onClick:function(){return e()},children:"Edit configuration"}):null]})]})},ConcurrencyLimits=function(n){var e=n.instanceConfig,t=n.hasSupport,r=n.concurrencyKeys,i=n.refetch,s=n.minValue,l=n.maxValue,a=n.selectedKey,d=n.onSelectKey,x=(0,c._)(k.useState(),2),m=x[0],p=x[1],h=k.useCallback(function(){d(void 0)},[d]),j=k.useMemo(function(){return(0,o._)(r).sort(function(n,e){return J.Bl.compare(n,e)})},[r]),onAdd=function(){p({actionType:"add"})};return!t&&e&&e.includes("SqliteEventLogStorage")?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ConcurrencyLimitHeader,{}),(0,u.jsx)(y.x,{margin:24,children:(0,u.jsx)(b.t,{icon:"error",title:"No concurrency support",description:"This instance does not support global concurrency limits. You will need to configure a different storage implementation (e.g. Postgres/MySQL) to use this feature."})})]}):!1===t?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ConcurrencyLimitHeader,{}),(0,u.jsx)(y.x,{margin:24,children:(0,u.jsx)(b.t,{icon:"error",title:"No concurrency support",description:"This instance does not currently support global concurrency limits. You may need to run `dagster instance migrate` to add the necessary tables to your dagster storage to support this feature."})})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ConcurrencyLimitHeader,{onAdd:onAdd}),0===r.length?(0,u.jsx)(y.x,{margin:24,children:(0,u.jsx)(b.t,{icon:"error",title:"No concurrency limits",description:(0,u.jsxs)(u.Fragment,{children:["No concurrency limits have been configured for this instance.\xa0",(0,u.jsx)(v.Z,{onClick:function(){return onAdd()},children:"Add a concurrency limit"}),"."]})})}):(0,u.jsx)(ConcurrencyTable,{concurrencyKeys:j,onDelete:function(n){p({actionType:"delete",concurrencyKey:n})},onEdit:function(n){p({actionType:"edit",concurrencyKey:n})},onSelect:d}),(0,u.jsx)(AddConcurrencyLimitDialog,{open:(null==m?void 0:m.actionType)==="add",onClose:function(){return p(void 0)},onComplete:i,minValue:null!=s?s:1,maxValue:null!=l?l:1e3}),(0,u.jsx)(DeleteConcurrencyLimitDialog,{concurrencyKey:m&&"delete"===m.actionType?m.concurrencyKey:"",open:(null==m?void 0:m.actionType)==="delete",onClose:function(){return p(void 0)},onComplete:i}),(0,u.jsx)(EditConcurrencyLimitDialog,{open:(null==m?void 0:m.actionType)==="edit",onClose:function(){return p(void 0)},onComplete:i,concurrencyKey:(null==m?void 0:m.actionType)==="edit"?m.concurrencyKey:"",minValue:null!=s?s:1,maxValue:null!=l?l:1e3}),(0,u.jsx)(ConcurrencyStepsDialog,{title:(0,u.jsxs)("span",{children:["Concurrency steps for ",(0,u.jsx)("strong",{children:a})]}),onClose:h,concurrencyKey:a,onUpdate:i})]})},ConcurrencyLimitHeader=function(n){var e=n.onAdd;return(0,u.jsxs)(y.x,{flex:{justifyContent:"space-between",alignItems:"center"},padding:{vertical:16,horizontal:24},border:"top-and-bottom",children:[(0,u.jsxs)(y.x,{flex:{alignItems:"center",direction:"row",gap:8},children:[(0,u.jsx)(h.pm,{children:"Global op/asset concurrency"}),(0,u.jsx)(_.V,{children:"Experimental"})]}),e?(0,u.jsx)(g.zx,{icon:(0,u.jsx)(C.JO,{name:"add_circle"}),onClick:function(){return e()},children:"Add concurrency limit"}):null]})},isValidLimit=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(!n)return!1;var r=parseInt(n);return!isNaN(r)&&String(r)===n.trim()&&r>=e&&r<=t},AddConcurrencyLimitDialog=function(n){var e,t=n.open,i=n.onClose,o=n.onComplete,l=n.maxValue,d=n.minValue,x=(0,c._)(k.useState(!1),2),m=x[0],p=x[1],h=(0,c._)(k.useState(""),2),j=h[0],f=h[1],C=(0,c._)(k.useState(""),2),b=C[0],v=C[1];k.useEffect(function(){f(""),v("")},[t]);var _=(0,c._)((0,a.D)(no),1)[0],K=(e=(0,r._)(function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return p(!0),[4,_({variables:{concurrencyKey:b,limit:parseInt(j.trim())}})];case 1:return n.sent(),p(!1),o(),i(),[2]}})}),function(){return e.apply(this,arguments)});return(0,u.jsxs)(S.Vq,{isOpen:t,title:"Add concurrency limit",onClose:i,children:[(0,u.jsxs)(S.a7,{children:[(0,u.jsx)(y.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,u.jsx)(y.x,{margin:{bottom:16},children:(0,u.jsx)(I.oi,{value:b||"",onChange:function(n){return v(n.target.value)},placeholder:"Concurrency key"})}),(0,u.jsxs)(y.x,{margin:{bottom:4},children:["Concurrency limit (",d,"-",l,"):"]}),(0,u.jsx)(y.x,{children:(0,u.jsx)(I.oi,{value:j||"",onChange:function(n){return f(n.target.value)},placeholder:"".concat(d," - ").concat(l)})})]}),(0,u.jsxs)(S.cN,{children:[(0,u.jsx)(g.zx,{intent:"none",onClick:i,children:"Cancel"}),(0,u.jsx)(g.zx,{intent:"primary",onClick:K,disabled:!isValidLimit(j.trim(),d,l)||!b||m,children:m?"Adding...":"Add limit"})]})]})},EditConcurrencyLimitDialog=function(n){var e,t=n.concurrencyKey,i=n.open,o=n.onClose,l=n.onComplete,d=n.minValue,x=n.maxValue,m=(0,c._)(k.useState(!1),2),p=m[0],j=m[1],f=(0,c._)(k.useState(""),2),C=f[0],b=f[1];k.useEffect(function(){b("")},[i]);var v=(0,c._)((0,a.D)(no),1)[0],_=(e=(0,r._)(function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return j(!0),[4,v({variables:{concurrencyKey:t,limit:parseInt(C.trim())}})];case 1:return n.sent(),j(!1),l(),o(),[2]}})}),function(){return e.apply(this,arguments)}),K=(0,u.jsxs)(u.Fragment,{children:["Edit ",(0,u.jsx)(h.fv,{children:t})]});return(0,u.jsxs)(S.Vq,{isOpen:i,title:K,onClose:o,children:[(0,u.jsxs)(S.a7,{children:[(0,u.jsx)(y.x,{margin:{bottom:4},children:"Concurrency key:"}),(0,u.jsx)(y.x,{margin:{bottom:16},children:(0,u.jsx)("strong",{children:t})}),(0,u.jsxs)(y.x,{margin:{bottom:4},children:["Concurrency limit (",d,"-",x,"):"]}),(0,u.jsx)(y.x,{children:(0,u.jsx)(I.oi,{value:C||"",onChange:function(n){return b(n.target.value)},placeholder:"".concat(d," - ").concat(x)})})]}),(0,u.jsxs)(S.cN,{children:[(0,u.jsx)(g.zx,{intent:"none",onClick:o,children:"Close"}),p?(0,u.jsx)(g.zx,{intent:"primary",disabled:!0,children:"Updating..."}):(0,u.jsx)(g.zx,{intent:"primary",onClick:_,disabled:!isValidLimit(C.trim(),d,x),children:"Update limit"})]})]})},DeleteConcurrencyLimitDialog=function(n){var e,t=n.concurrencyKey,i=n.open,o=n.onClose,l=n.onComplete,d=(0,c._)(k.useState(!1),2),y=d[0],x=d[1],m=(0,c._)((0,a.D)(ns),1)[0],p=(e=(0,r._)(function(){return(0,s.Jh)(this,function(n){switch(n.label){case 0:return x(!0),[4,m({variables:{concurrencyKey:t}})];case 1:return n.sent(),x(!1),l(),o(),[2]}})}),function(){return e.apply(this,arguments)}),j=(0,u.jsxs)(u.Fragment,{children:["Delete ",(0,u.jsx)(h.fv,{children:t})]});return(0,u.jsxs)(S.Vq,{isOpen:i,title:j,onClose:o,children:[(0,u.jsxs)(S.a7,{children:["Delete concurrency limit\xa0",(0,u.jsx)("strong",{children:t}),"?"]}),(0,u.jsxs)(S.cN,{children:[(0,u.jsx)(g.zx,{intent:"none",onClick:o,children:"Close"}),y?(0,u.jsx)(g.zx,{intent:"danger",disabled:!0,children:"Deleting..."}):(0,u.jsx)(g.zx,{intent:"danger",onClick:p,children:"Delete limit"})]})]})},ConcurrencyActionMenu=function(n){var e=n.pendingStep,t=n.onUpdate,i=(0,c._)((0,a.D)(nu),1)[0];return(0,u.jsx)(K.J,{content:(0,u.jsxs)(O.v2,{children:[(0,u.jsx)(O.sN,{icon:"status",text:"Free concurrency slot for step",onClick:(0,r._)(function(){var n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,i({variables:{runId:e.runId,stepKey:e.stepKey}})];case 1:if(!(null===(n=r.sent().data)||void 0===n?void 0:n.freeConcurrencySlots))return[3,3];return t(),[4,(0,U.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slot"})];case 2:r.sent(),r.label=3;case 3:return[2]}})})},"free-concurrency-slots-step"),(0,u.jsx)(O.sN,{icon:"status",text:"Free all concurrency slots for run",onClick:(0,r._)(function(){var n;return(0,s.Jh)(this,function(r){switch(r.label){case 0:return[4,(0,U.B7)({message:"Freeing concurrency slots..."})];case 1:return r.sent(),[4,i({variables:{runId:e.runId}})];case 2:if(!(null===(n=r.sent().data)||void 0===n?void 0:n.freeConcurrencySlots))return[3,4];return t(),[4,(0,U.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"})];case 3:r.sent(),r.label=4;case 4:return[2]}})})},"free-concurrency-slots-run")]}),position:"bottom-right",children:(0,u.jsx)(g.zx,{rightIcon:(0,u.jsx)(C.JO,{name:"expand_more"}),children:"Actions"})})},ConcurrencyStepsDialog=function(n){var e=n.concurrencyKey,t=n.onClose,r=n.title,c=n.onUpdate,i=(0,l.a)(nl,{variables:{concurrencyKey:e||""},skip:!e});(0,B.Hu)(i,"ConcurrencyKeyDetailsQuery",{skip:!e}),(0,V.C4)(i,V.dT);var o=i.data,s=k.useCallback(function(){i.refetch(),c()},[i,c]);return(0,u.jsxs)(S.Vq,{isOpen:!!e,title:r,onClose:t,style:{minWidth:"400px",maxWidth:"1000px",width:"90vw",maxHeight:"90vh"},children:[(0,u.jsx)(y.x,{padding:{vertical:16},flex:{grow:1},style:{overflowY:"auto"},children:o?(0,u.jsx)(PendingStepsTable,{keyInfo:o.instance.concurrencyLimit,refresh:s}):(0,u.jsx)(y.x,{padding:{vertical:64},children:(0,u.jsx)(x.$,{purpose:"section"})})}),(0,u.jsx)(S.cN,{children:(0,u.jsx)(g.zx,{intent:"none",onClick:t,children:"Close"})})]})},PendingStepsTable=function(n){var e,t=n.keyInfo,r=n.refresh,c=(0,o._)(new Set(t.pendingSteps.map(function(n){return n.runId}))),i=(0,l.a)(na,{variables:{filter:{runIds:c}},skip:!t.pendingSteps.length});(0,B.Hu)(i,"RunsForConcurrencyKeyQuery",{skip:!t.pendingSteps.length});var s={};((null===(e=i.data)||void 0===e?void 0:e.pipelineRunsOrError.__typename)==="Runs"?i.data.pipelineRunsOrError.results:[]).forEach(function(n){s[n.id]=n.status});var a=(0,o._)(t.pendingSteps);a.sort(function(n,e){return n.priority&&e.priority&&n.priority!==e.priority?n.priority-e.priority:n.enqueuedTimestamp-e.enqueuedTimestamp});var d=a.filter(function(n){return!!n.assignedTimestamp}),x=a.filter(function(n){return!n.assignedTimestamp}),m=(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Run ID"}),(0,u.jsx)("th",{children:"Step key"}),(0,u.jsx)("th",{children:"Assigned"}),(0,u.jsx)("th",{children:"Queued"}),(0,u.jsx)("th",{children:(0,u.jsxs)(y.x,{flex:{alignItems:"center",direction:"row",gap:4},children:["Priority",(0,u.jsx)(L.u,{placement:"top",content:"Priority can be set on each op/asset using the 'dagster/priority' tag. Higher priority steps will be assigned slots first.",children:(0,u.jsx)(C.JO,{name:"info",color:R.md()})})]})}),(0,u.jsx)("th",{})]})});return a.length?(0,u.jsxs)(T.i,{children:[m,(0,u.jsx)("tbody",{style:{backgroundColor:R.B5()},children:d.map(function(n){return(0,u.jsx)(PendingStepRow,{step:n,statusByRunId:s,onUpdate:r},n.runId+n.stepKey)})}),(0,u.jsx)("tbody",{children:x.map(function(n){return(0,u.jsx)(PendingStepRow,{step:n,statusByRunId:s,onUpdate:r},n.runId+n.stepKey)})})]}):(0,u.jsxs)(T.i,{children:[m,(0,u.jsx)("tbody",{children:(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:6,children:(0,u.jsx)(y.x,{flex:{alignItems:"center",justifyContent:"center"},style:{color:R.$()},padding:16,children:"There are no active or pending steps for this concurrency key."})})})})]})},PendingStepRow=function(n){var e=n.step,t=n.statusByRunId,r=n.onUpdate,c=t[e.runId];return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:c?(0,u.jsx)(w.rU,{to:"/runs/".concat(e.runId),children:(0,u.jsxs)(y.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,u.jsx)(Z.O_,{status:c,size:10}),(0,u.jsx)(h.fv,{children:(0,G.EI)({id:e.runId})}),W.hd.has(c)?(0,u.jsx)(L.u,{placement:"top",content:"Slots for canceled / failed runs can automatically be freed by configuring a run monitoring setting.",children:(0,u.jsx)(C.JO,{name:"info",color:R.md()})}):null]})}):(0,u.jsx)(h.fv,{children:(0,G.EI)({id:e.runId})})}),(0,u.jsx)("td",{children:(0,u.jsx)(h.fv,{children:e.stepKey})}),(0,u.jsx)("td",{children:e.assignedTimestamp?(0,u.jsx)(X.Q,{startUnix:e.assignedTimestamp,endUnix:null}):"-"}),(0,u.jsx)("td",{children:e.enqueuedTimestamp?(0,u.jsx)(X.Q,{startUnix:e.enqueuedTimestamp,endUnix:null}):"-"}),(0,u.jsx)("td",{children:e.priority}),(0,u.jsx)("td",{children:(0,u.jsx)(ConcurrencyActionMenu,{pendingStep:e,onUpdate:r})})]})},nt=(0,d.Ps)(InstanceConcurrency_templateObject()),nr=(0,d.Ps)(InstanceConcurrency_templateObject1(),nt),nc=(0,d.Ps)(_templateObject2()),ni=(0,d.Ps)(_templateObject3(),nc),no=(0,d.Ps)(_templateObject4()),ns=(0,d.Ps)(_templateObject5()),nu=(0,d.Ps)(_templateObject6()),nl=(0,d.Ps)(_templateObject7(),nr),na=(0,d.Ps)(_templateObject8())},4120:function(n,e,t){t.d(e,{Z:function(){return InstanceTabs}});var r=t(52322),c=t(18399),i=t(56024),o=t(2784),s=t(74897),u=t(78945),l=t(55237),a=t(67486),d=t(25195),y=t(77334),x=t(29255),m=(0,o.memo)(function(){var n=(0,o.useContext)(x.Z).daemons;return n?(0,r.jsx)(y.a,{content:n.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(a.JO,{name:"warning",color:d.qr()})}):null}),p=t(43180),h=t(63832),j=(0,o.memo)(function(n){var e=n.placeholder,t=(0,o.useContext)(x.Z).codeLocations;return t?"spinner"===t.type?(0,r.jsx)(p.u,{content:t.content,placement:"bottom",children:(0,r.jsx)(h.$,{purpose:"body-text",fillColor:d.md()})}):(0,r.jsx)(y.a,{content:t.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(a.JO,{name:"warning",color:d.qr()})}):e?(0,r.jsx)("div",{style:{width:"16px"}}):null}),f=t(40049),InstanceTabs=function(n){var e=n.refreshState,t=n.tab,a=(0,o.useContext)(s.N).healthTitle,d=(0,u._)();return(0,r.jsxs)(c.x,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,r.jsxs)(i.mQ,{selectedTabId:t,children:[(0,r.jsx)(f.f,{id:"locations",title:"Code locations",to:"/locations",icon:(0,r.jsx)(j,{placeholder:!1})}),(0,r.jsx)(f.f,{id:"health",title:a,to:"/health",icon:(0,r.jsx)(m,{})}),d?(0,r.jsx)(f.f,{id:"concurrency",title:"Concurrency limits",to:"/concurrency"}):null,d?(0,r.jsx)(f.f,{id:"config",title:"Configuration",to:"/config"}):null]}),e?(0,r.jsx)(c.x,{padding:{bottom:8},children:(0,r.jsx)(l.xi,{refreshState:e})}):null]})}}}]);
//# sourceMappingURL=5502.5d74d369115acc22.js.map