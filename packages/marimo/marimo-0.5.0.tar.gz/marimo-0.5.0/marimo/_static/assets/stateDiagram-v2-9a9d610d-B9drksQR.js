import{p as e,d as t,s,D as o,a,S as r,b as i,c as n}from"./styles-d20c7d72-BMiVGo2P.js";import{G as d}from"./graph-5-xspqSf.js";import{s as c}from"./transform-Brw4-HcM.js";import{l,c as p,x as g,h as b,i as h}from"./mermaid-BfVwFeby.js";import{r as y}from"./index-fc10efb0-Dejim5rl.js";import"./layout-C97fLiLr.js";import"./index-COv5rzp-.js";import"./_baseEach-Cqqj63vo.js";import"./clone-BmS9hDRU.js";import"./edges-d32062c0-Cw0SLrcW.js";import"./createText-6b48ae7d-Der02V3f.js";import"./sortBy-CsZpNWx7.js";import"./toInteger-BOO7sqef.js";const m="rect",u="rectWithTitle",f="statediagram",x=`${f}-state`,w="transition",$=`${w} note-edge`,T=`${f}-note`,j=`${f}-cluster`,S=`${f}-cluster-alt`,D="parent",A="note",v="----",B=`${v}${A}`,k=`${v}${D}`,E="fill:none",R="fill: #333",V="text",N="normal";let C={},I=0;function L(e="",t=0,s="",o=v){return`state-${e}${null!==s&&s.length>0?`${o}${s}`:""}-${t}`}const M=(e,t,s,r,i,n)=>{const d=s.id,c=null==(g=r[d])?"":g.classes?g.classes.join(" "):"";var g;if("root"!==d){let t=m;!0===s.start&&(t="start"),!1===s.start&&(t="end"),s.type!==o&&(t=s.type),C[d]||(C[d]={id:d,shape:t,description:h.sanitizeText(d,p()),classes:`${c} ${x}`});const r=C[d];s.description&&(Array.isArray(r.description)?(r.shape=u,r.description.push(s.description)):r.description.length>0?(r.shape=u,r.description===d?r.description=[s.description]:r.description=[r.description,s.description]):(r.shape=m,r.description=s.description),r.description=h.sanitizeTextOrArray(r.description,p())),1===r.description.length&&r.shape===u&&(r.shape=m),!r.type&&s.doc&&(l.info("Setting cluster for ",d,G(s)),r.type="group",r.dir=G(s),r.shape=s.type===a?"divider":"roundedWithTitle",r.classes=r.classes+" "+j+" "+(n?S:""));const i={labelStyle:"",shape:r.shape,labelText:r.description,classes:r.classes,style:"",id:d,dir:r.dir,domId:L(d,I),type:r.type,padding:15,centerLabel:!0};if(s.note){const t={labelStyle:"",shape:"note",labelText:s.note.text,classes:T,style:"",id:d+B+"-"+I,domId:L(d,I,A),type:r.type,padding:15},o={labelStyle:"",shape:"noteGroup",labelText:s.note.text,classes:r.classes,style:"",id:d+k,domId:L(d,I,D),type:"group",padding:0};I++;const a=d+k;e.setNode(a,o),e.setNode(t.id,t),e.setNode(d,i),e.setParent(d,a),e.setParent(t.id,a);let n=d,c=t.id;"left of"===s.note.position&&(n=t.id,c=d),e.setEdge(n,c,{arrowhead:"none",arrowType:"",style:E,labelStyle:"",classes:$,arrowheadStyle:R,labelpos:"c",labelType:V,thickness:N})}else e.setNode(d,i)}t&&"root"!==t.id&&(l.trace("Setting node ",d," to be child of its parent ",t.id),e.setParent(d,t.id)),s.doc&&(l.trace("Adding nodes children "),z(e,s,s.doc,r,i,!n))},z=(e,t,s,a,n,d)=>{l.trace("items",s),s.forEach((s=>{switch(s.stmt){case i:case o:M(e,t,s,a,n,d);break;case r:{M(e,t,s.state1,a,n,d),M(e,t,s.state2,a,n,d);const o={id:"edge"+I,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:E,labelStyle:"",label:h.sanitizeText(s.description,p()),arrowheadStyle:R,labelpos:"c",labelType:V,thickness:N,classes:w};e.setEdge(s.state1.id,s.state2.id,o,I),I++}}}))},G=(e,t=n)=>{let s=t;if(e.doc)for(let o=0;o<e.doc.length;o++){const t=e.doc[o];"dir"===t.stmt&&(s=t.value)}return s},P={parser:e,db:t,renderer:{setConf:function(e){const t=Object.keys(e);for(const s of t)e[s]},getClasses:function(e,t){return t.db.extract(t.db.getRootDocV2()),t.db.getClasses()},draw:async function(e,t,s,o){l.info("Drawing state diagram (v2)",t),C={},o.db.getDirection();const{securityLevel:a,state:r}=p(),i=r.nodeSpacing||50,n=r.rankSpacing||50;l.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),l.info(o.db.getRootDocV2());const h=o.db.getStates(),u=new d({multigraph:!0,compound:!0}).setGraph({rankdir:G(o.db.getRootDocV2()),nodesep:i,ranksep:n,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));let x;M(u,void 0,o.db.getRootDocV2(),h,o.db,!0),"sandbox"===a&&(x=c("#i"+t));const w=c("sandbox"===a?x.nodes()[0].contentDocument.body:"body"),$=w.select(`[id="${t}"]`),T=w.select("#"+t+" g");await y(T,u,["barb"],f,t);g.insertTitle($,"statediagramTitleText",r.titleTopMargin,o.db.getDiagramTitle());const j=$.node().getBBox(),S=j.width+16,D=j.height+16;$.attr("class",f);const A=$.node().getBBox();b($,D,S,r.useMaxWidth);const v=`${A.x-8} ${A.y-8} ${S} ${D}`;l.debug(`viewBox ${v}`),$.attr("viewBox",v);const B=document.querySelectorAll('[id="'+t+'"] .edgeLabel .label');for(const d of B){const e=d.getBBox(),t=document.createElementNS("http://www.w3.org/2000/svg",m);t.setAttribute("rx",0),t.setAttribute("ry",0),t.setAttribute("width",e.width),t.setAttribute("height",e.height),d.insertBefore(t,d.firstChild)}}},styles:s,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,t.clear()}};export{P as diagram};
