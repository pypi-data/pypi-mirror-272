import{d as x,r as f,o as L,ar as C,a as T,c as _,e as P,w as v,f as y,g,h as k,F as V,u as h,$ as M,s,aA as m,M as t,b as r,D as c,P as A}from"./index-2dd0c7d2.js";import{e as b}from"./eventbus-d154090d.js";import{b as p}from"./helpers-4d7c5bf6.js";import{a as w}from"./VList-d110868a.js";import{V as F}from"./VCard-907b4685.js";import{V as R}from"./VMenu-97c1c955.js";import{V as S}from"./VListItem-cb387084.js";const D=async function(e,o,i=0,a=0,l=!0){const d=Array.isArray(e)?e:[e];if(d.length==0)return;const u=[];l&&u.push(...B(d,o)),u.push(...Q(d,o)),b.emit("contextmenu",{items:u,posX:i,posY:a})},B=function(e,o){const i=[];if(e.length==0||!p(e[0]))return i;let a=m.NEXT;return(e.length>10||[t.ALBUM,t.PLAYLIST].includes(e[0].media_type))&&(a=m.REPLACE_NEXT),e.length==1&&o&&o.uri!=e[0].uri&&(o.media_type==t.PLAYLIST&&i.push({label:"play_playlist_from",action:()=>{r.playMedia(o.uri,void 0,!1,e[0].item_id)},icon:"mdi-play-circle-outline",labelArgs:[],disabled:!s.activePlayerQueue}),o.media_type==t.ALBUM&&i.push({label:"play_album_from",action:()=>{r.playMedia(o.uri,void 0,!1,e[0].item_id)},icon:"mdi-play-circle-outline",labelArgs:[],disabled:!s.activePlayerQueue})),i.push({label:"play_now",action:()=>{r.playMedia(e.map(l=>l.uri),void 0)},icon:"mdi-play-circle-outline",labelArgs:[],disabled:!s.activePlayerQueue}),(e.length===1||e[0].media_type===t.TRACK)&&i.push({label:"play_next",action:()=>{r.playMedia(e.map(l=>l.uri),a)},icon:"mdi-skip-next-circle-outline",labelArgs:[],disabled:!s.activePlayerQueue}),i.push({label:"add_queue",action:()=>{r.playMedia(e.map(l=>l.uri),m.ADD)},icon:"mdi-playlist-plus",labelArgs:[],disabled:!s.activePlayerQueue}),E(e[0])&&i.push({label:"play_radio",action:()=>{r.playMedia(e.map(l=>l.uri),void 0,!0)},icon:"mdi-radio-tower",labelArgs:[],disabled:!s.activePlayerQueue}),i},Q=function(e,o){const i=[];if(e.length==0)return i;if(e.length===1&&e[0]!==o&&p(e[0])&&i.push({label:"show_info",labelArgs:[],action:()=>{var a;c.push({name:e[0].media_type,params:{itemId:e[0].item_id,provider:e[0].provider},query:{album:"album"in e[0]?(a=e[0].album)==null?void 0:a.uri:""}})},icon:"mdi-information-outline"}),e.length===1&&p(e[0])&&"artists"in e[0]&&e[0].artists.length===1)for(const a of e[0].artists)i.push({label:"goto_artist",labelArgs:[a.name],action:()=>{c.push({name:"artist",params:{itemId:a.item_id,provider:a.provider}})},icon:"mdi-account-music"});if(e.length===1&&p(e[0])&&"album"in e[0]&&e[0].album&&i.push({label:"goto_album",labelArgs:[e[0].album.name],action:()=>{c.push({name:"album",params:{itemId:e[0].album.item_id,provider:e[0].album.provider}})},icon:"mdi-album"}),e.length===1&&(e[0]==o||!p(e[0]))&&i.push({label:"refresh_item",labelArgs:[],action:async()=>{await r.refreshItem(e[0]),c.go(0)},icon:"mdi-refresh"}),e[0].provider!="library"&&p(e[0])&&i.push({label:"add_library",labelArgs:[],action:()=>{for(const a of e)r.addItemToLibrary(a)},icon:"mdi-bookshelf"}),e[0].provider=="library"&&i.push({label:"remove_library",labelArgs:[],action:()=>{if(confirm(M("confirm_library_remove"))){for(const a of e)r.removeItemFromLibrary(a.media_type,a.item_id);e[0].item_id==(o==null?void 0:o.item_id)?c.go(-1):c.go(0)}},icon:"mdi-bookshelf"}),"favorite"in e[0]&&!e[0].favorite&&i.push({label:"favorites_add",labelArgs:[],action:()=>{for(const a of e)r.addItemToFavorites(a)},icon:"mdi-heart-outline"}),"favorite"in e[0]&&e[0].favorite&&i.push({label:"favorites_remove",labelArgs:[],action:()=>{for(const a of e)r.removeItemFromFavorites(a.media_type,a.item_id),a.favorite=!1},icon:"mdi-heart"}),o&&o.media_type===t.PLAYLIST){const a=o;e[0].media_type===t.TRACK&&a.is_editable&&i.push({label:"remove_playlist",labelArgs:[],action:()=>{r.removePlaylistTracks(a.item_id,e.map(l=>l.position))},icon:"mdi-minus-circle-outline"})}return(e[0].media_type===t.TRACK||e[0].media_type===t.ALBUM)&&"provider_mappings"in e[0]&&i.push({label:"add_playlist",labelArgs:[],action:()=>{b.emit("playlistdialog",{items:e,parentItem:o})},icon:"mdi-plus-circle-outline"}),i},E=function(e){var o,i;if("provider_mappings"in e){for(const a of e.provider_mappings)if((o=r.providers[a.provider_instance])!=null&&o.supported_features.includes(A.SIMILAR_TRACKS))return!0}else if((i=r.providers[e.provider])!=null&&i.supported_features.includes(A.SIMILAR_TRACKS))return!0;return!1},O=x({__name:"ItemContextMenu",setup(e){const o=f(!1),i=f([]),a=f(0),l=f(0);return L(()=>{b.on("contextmenu",async d=>{i.value=d.items,a.value=d.posX||0,l.value=d.posY||0,C(()=>{o.value=!0})}),T(()=>{b.off("contextmenu")})}),(d,u)=>(_(),P(R,{modelValue:o.value,"onUpdate:modelValue":[u[0]||(u[0]=n=>o.value=n),u[1]||(u[1]=n=>{h(s).dialogActive=n})],target:[a.value,l.value],scrim:""},{default:v(()=>[y(F,{"min-width":"260"},{default:v(()=>[y(w,{density:"compact",slim:"",tile:""},{default:v(()=>[(_(!0),g(V,null,k(i.value,n=>(_(),g("div",{key:n.label,class:"menurow"},[y(S,{variant:"text",title:h(M)(n.label,n.labelArgs||[]),disabled:n.disabled==!0,"prepend-icon":n.icon,"append-icon":n.selected?"mdi-check":void 0,onClick:()=>n.action?n.action():""},null,8,["title","disabled","prepend-icon","append-icon","onClick"])]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","target"]))}});export{O as _,B as a,Q as g,D as s};
