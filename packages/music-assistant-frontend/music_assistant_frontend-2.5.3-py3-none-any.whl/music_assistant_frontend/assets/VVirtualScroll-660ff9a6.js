import{m as L,t as W,c as X,a as re,u as oe}from"./VListItem-cb387084.js";import{l as E,m as G,J as O,f as S,F as J,G as se,ai as ue,a5 as I,ax as U,r as q,z,aw as Q,aX as B,b7 as ce,ar as ie,aZ as ve,aQ as fe,y as de,au as me,C as F,o as he}from"./index-2dd0c7d2.js";import{i as ge}from"./VMenu-97c1c955.js";const pe=E({renderless:Boolean,...L()},"VVirtualScrollItem"),Se=G()({name:"VVirtualScrollItem",inheritAttrs:!1,props:pe(),emits:{"update:height":l=>!0},setup(l,a){let{attrs:i,emit:o,slots:t}=a;const{resizeRef:n,contentRect:v}=W(void 0,"border");O(()=>{var u;return(u=v.value)==null?void 0:u.height},u=>{u!=null&&o("update:height",u)}),X(()=>{var u,s;return l.renderless?S(J,null,[(u=t.default)==null?void 0:u.call(t,{itemRef:n})]):S("div",se({ref:n,class:["v-virtual-scroll__item",l.class],style:l.style},i),[(s=t.default)==null?void 0:s.call(t)])})}}),Ve=-1,ye=1,D=100,Te=E({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");function we(l,a){const i=ue(),o=I(0);U(()=>{o.value=parseFloat(l.itemHeight||0)});const t=I(0),n=I(Math.ceil((parseInt(l.height)||i.height.value)/(o.value||16))||1),v=I(0),u=I(0),s=q(),g=q();let R=0;const{resizeRef:P,contentRect:_}=W();U(()=>{P.value=s.value});const T=z(()=>{var e;return s.value===document.documentElement?i.height.value:((e=_.value)==null?void 0:e.height)||parseInt(l.height)||0}),V=z(()=>!!(s.value&&g.value&&T.value&&o.value));let f=Array.from({length:a.value.length}),c=Array.from({length:a.value.length});const m=I(0);let y=-1;function Z(e){return f[e]||o.value}const k=ce(()=>{const e=performance.now();c[0]=0;const r=a.value.length;for(let d=1;d<=r-1;d++)c[d]=(c[d-1]||0)+Z(d-1);m.value=Math.max(m.value,performance.now()-e)},m),$=O(V,e=>{e&&($(),R=g.value.offsetTop,k.immediate(),w(),~y&&ie(()=>{ve&&window.requestAnimationFrame(()=>{N(y),y=-1})}))});Q(()=>{k.clear()});function j(e,r){const d=f[e],h=o.value;o.value=h?Math.min(o.value,r):r,(d!==r||h!==o.value)&&(f[e]=r,k())}function p(e){return e=B(e,0,a.value.length-1),c[e]||0}function H(e){return Ie(c,e)}let A=0,b=0,M=0;O(T,(e,r)=>{r&&(w(),e<r&&requestAnimationFrame(()=>{b=0,w()}))});function K(){if(!s.value||!g.value)return;const e=s.value.scrollTop,r=performance.now();r-M>500?(b=Math.sign(e-A),R=g.value.offsetTop):b=e-A,A=e,M=r,w()}function Y(){!s.value||!g.value||(b=0,M=0,w())}let C=-1;function w(){cancelAnimationFrame(C),C=requestAnimationFrame(ee)}function ee(){if(!s.value||!T.value)return;const e=A-R,r=Math.sign(b),d=Math.max(0,e-D),h=B(H(d),0,a.value.length),le=e+T.value+D,x=B(H(le)+1,h+1,a.value.length);if((r!==Ve||h<t.value)&&(r!==ye||x>n.value)){const ae=p(t.value)-p(h),ne=p(x)-p(n.value);Math.max(ae,ne)>D?(t.value=h,n.value=x):(h<=0&&(t.value=h),x>=a.value.length&&(n.value=x))}v.value=p(t.value),u.value=p(a.value.length)-p(n.value)}function N(e){const r=p(e);!s.value||e&&!r?y=e:s.value.scrollTop=r}const te=z(()=>a.value.slice(t.value,n.value).map((e,r)=>({raw:e,index:r+t.value})));return O(a,()=>{f=Array.from({length:a.value.length}),c=Array.from({length:a.value.length}),k.immediate(),w()},{deep:!0}),{containerRef:s,markerRef:g,computedItems:te,paddingTop:v,paddingBottom:u,scrollToIndex:N,handleScroll:K,handleScrollend:Y,handleItemResize:j}}function Ie(l,a){let i=l.length-1,o=0,t=0,n=null,v=-1;if(l[i]<a)return i;for(;o<=i;)if(t=o+i>>1,n=l[t],n>a)i=t-1;else if(n<a)v=t,o=t+1;else return n===a?t:o;return v}const Re=E({items:{type:Array,default:()=>[]},renderless:Boolean,...Te(),...L(),...re()},"VVirtualScroll"),ke=G()({name:"VVirtualScroll",props:Re(),setup(l,a){let{slots:i}=a;const o=fe("VVirtualScroll"),{dimensionStyles:t}=oe(l),{containerRef:n,markerRef:v,handleScroll:u,handleScrollend:s,handleItemResize:g,scrollToIndex:R,paddingTop:P,paddingBottom:_,computedItems:T}=we(l,de(l,"items"));return me(()=>l.renderless,()=>{function V(){var m,y;const c=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";n.value===document.documentElement?(document[c]("scroll",u,{passive:!0}),document[c]("scrollend",s)):((m=n.value)==null||m[c]("scroll",u,{passive:!0}),(y=n.value)==null||y[c]("scrollend",s))}he(()=>{n.value=ge(o.vnode.el,!0),V(!0)}),Q(V)}),X(()=>{const V=T.value.map(f=>S(Se,{key:f.index,renderless:l.renderless,"onUpdate:height":c=>g(f.index,c)},{default:c=>{var m;return(m=i.default)==null?void 0:m.call(i,{item:f.raw,index:f.index,...c})}}));return l.renderless?S(J,null,[S("div",{ref:v,class:"v-virtual-scroll__spacer",style:{paddingTop:F(P.value)}},null),V,S("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:F(_.value)}},null)]):S("div",{ref:n,class:["v-virtual-scroll",l.class],onScrollPassive:u,onScrollend:s,style:[t.value,l.style]},[S("div",{ref:v,class:"v-virtual-scroll__container",style:{paddingTop:F(P.value),paddingBottom:F(_.value)}},[V])])}),{scrollToIndex:R}}});export{ke as V};
