"use strict";(self.webpackChunk_dfnotebook_dfnotebook_extension=self.webpackChunk_dfnotebook_dfnotebook_extension||[]).push([[246],{41246:(e,t,o)=>{o.r(t),o.d(t,{DataflowNotebook:()=>v,DataflowNotebookActions:()=>f,DataflowNotebookModel:()=>m,DataflowNotebookModelFactory:()=>g,DataflowNotebookPanel:()=>w,DataflowNotebookWidgetFactory:()=>b,DataflowStaticNotebook:()=>l,IDataflowNotebookWidgetFactory:()=>h});var n,l,a=o(15923),d=o(8702),c=o(90265),r=o(64053),i=o(74602),s=o(48291),u=o(27412);class f{static get executed(){return n.executed}static get executionScheduled(){return n.executionScheduled}static get selectionExecuted(){return n.selectionExecuted}constructor(){}}!function(e){e.run=function(e,t,o,l){if(!e.model||!e.activeCell)return Promise.resolve(!1);const a=n.getState(e),d=n.runSelected(e,t,o,l);return n.handleRunState(e,a,!1),d},e.runAndAdvance=async function(e,t,o,l){var a;if(!e.model||!e.activeCell)return Promise.resolve(!1);const c=n.getState(e),r=n.runSelected(e,t,o,l),i=e.model;return e.activeCellIndex===e.widgets.length-1?(i.sharedModel.insertCell(e.widgets.length,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===(null===(a=e.activeCell)||void 0===a?void 0:a.inViewport)&&await(0,d.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit"):e.activeCellIndex++,n.handleRunState(e,c,!0),r},e.runAndInsert=async function(e,t,o,l){var a;if(!e.model||!e.activeCell)return Promise.resolve(!1);const c=n.getState(e),r=n.runSelected(e,t,o,l);return e.model.sharedModel.insertCell(e.activeCellIndex+1,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===(null===(a=e.activeCell)||void 0===a?void 0:a.inViewport)&&await(0,d.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit",n.handleRunState(e,c,!0),r},e.runAll=function(e,t,o,l){if(!e.model||!e.activeCell)return Promise.resolve(!1);const a=n.getState(e);e.widgets.forEach((t=>{e.select(t)}));const d=n.runSelected(e,t,o,l);return n.handleRunState(e,a,!0),d},e.renderAllMarkdown=function(e){if(!e.model||!e.activeCell)return Promise.resolve(!1);const t=e.activeCellIndex,o=n.getState(e);if(e.widgets.forEach(((t,o)=>{"markdown"===t.model.type&&(e.select(t),e.activeCellIndex=o)})),"markdown"!==e.activeCell.model.type)return Promise.resolve(!0);const l=n.runSelected(e);return e.activeCellIndex=t,n.handleRunState(e,o,!0),l},e.runAllAbove=function(e,t,o,l){const{activeCell:a,activeCellIndex:d,model:c}=e;if(!c||!a||d<1)return Promise.resolve(!1);const r=n.getState(e);e.activeCellIndex--,e.deselectAll();for(let t=0;t<e.activeCellIndex;++t)e.select(e.widgets[t]);const i=n.runSelected(e,t,o,l);return e.activeCellIndex++,n.handleRunState(e,r,!0),i},e.runAllBelow=function(e,t,o,l){if(!e.model||!e.activeCell)return Promise.resolve(!1);const a=n.getState(e);e.deselectAll();for(let t=e.activeCellIndex;t<e.widgets.length;++t)e.select(e.widgets[t]);const d=n.runSelected(e,t,o,l);return n.handleRunState(e,a,!0),d}}(f||(f={})),function(e){e.executed=new i.Signal({}),e.executionScheduled=new i.Signal({}),e.selectionExecuted=new i.Signal({}),e.getState=function(e){var t,o;return{wasFocused:e.node.contains(document.activeElement),activeCellId:null!==(o=null===(t=e.activeCell)||void 0===t?void 0:t.model.id)&&void 0!==o?o:null}},e.handleState=function(e,t,o=!1){const{activeCell:n,activeCellIndex:l}=e;(t.wasFocused||"edit"===e.mode)&&e.activate(),o&&n&&e.scrollToItem(l,"auto",0).catch((e=>{}))},e.handleRunState=function(e,t,o=!1){(t.wasFocused||"edit"===e.mode)&&e.activate();const{activeCell:n,activeCellIndex:l}=e;o&&n&&e.scrollToItem(l,"smart",0).catch((e=>{}))},e.runSelected=function(t,o,n,l){t.mode="command";let d=t.activeCellIndex;const i=t.widgets.filter(((e,o)=>{const n=t.isSelectedOrActive(e);return n&&(d=o),n}));return t.activeCellIndex=d,t.deselectAll(),Promise.all(i.map((d=>async function(t,o,n,l,d){var i,f,m;const g=(d=d||c.nullTranslator).load("jupyterlab");switch(o.model.type){case"markdown":o.rendered=!0,o.inputHidden=!1,e.executed.emit({notebook:t,cell:o,success:!0});break;case"code":if(n){if(n.isTerminating){await(0,a.showDialog)({title:g.__("Kernel Terminating"),body:g.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(i=n.session)||void 0===i?void 0:i.path),buttons:[a.Dialog.okButton()]});break}if(n.pendingInput)return await(0,a.showDialog)({title:g.__("Cell not executed due to pending input"),body:g.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[a.Dialog.okButton()]}),!1;if(n.hasNoKernel&&await n.startKernel()&&l&&await l.selectKernel(n),n.hasNoKernel)return o.model.sharedModel.transact((()=>{o.model.clearExecution()})),!0;const d=null!==(m=null===(f=t.model)||void 0===f?void 0:f.deletedCells)&&void 0!==m?m:[],c={},v={},w={},C={};if(t.model)for(let e=0;e<t.model.cells.length;e++){const o=t.model.cells.get(e),n=t.widgets[e];if("code"===o.type){const e=o.id.replace(/-/g,"").substring(0,8),t=o.getMetadata("tag");t&&(C[t]=e),c[e]=o.sharedModel.getSource(),v[e]=n;let l=[];for(let e=0;e<n.outputArea.model.length;++e){const t=n.outputArea.model.get(e);t.metadata.output_tag&&l.push(t.metadata.output_tag)}w[e]=l}}const h={uuid:o.model.id.replace(/-/g,"").substring(0,8)||"",code_dict:c,output_tags:w,input_tags:C,auto_update_flags:{},force_cached_flags:{}};e.executionScheduled.emit({notebook:t,cell:o});let b=!1;try{const e=await u.DataflowCodeCell.execute(o,n,{deletedCells:d,recordTiming:t.notebookConfig.recordTiming},h,v);d.splice(0,d.length),b=(()=>{if(o.isDisposed)return!1;if(!e)return!0;if("ok"===e.content.status){const n=e.content;return n.payload&&n.payload.length&&function(e,t,o){var n;const l=null===(n=e.payload)||void 0===n?void 0:n.filter((e=>"set_next_input"===e.source))[0];if(!l)return;const a=l.text;if(l.replace)return void o.model.sharedModel.setSource(a);const d=t.model.sharedModel,c=t.model.cells,i=(0,r.findIndex)(c,(e=>e===o.model));-1===i?d.insertCell(d.cells.length,{cell_type:"code",source:a,metadata:{trusted:!1}}):d.insertCell(i+1,{cell_type:"code",source:a,metadata:{trusted:!1}})}(n,t,o),!0}throw new s.KernelError(e.content)})()}catch(n){if(!o.isDisposed&&!n.message.startsWith("Canceled"))throw e.executed.emit({notebook:t,cell:o,success:!1,error:n}),n;b=!1}return b&&e.executed.emit({notebook:t,cell:o,success:!0}),b}o.model.sharedModel.transact((()=>{o.model.clearExecution()}),!1)}return Promise.resolve(!0)}(t,d,o,n,l)))).then((o=>!t.isDisposed&&(e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[d]}),t.update(),o.every((e=>e))))).catch((o=>{if(!o.message.startsWith("KernelReplyNotOK"))throw o;return i.map((e=>{"code"===e.model.type&&null==e.model.executionCount&&e.setPrompt("")})),e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[d]}),t.update(),!1}))},e.selectedCells=function(e){return e.widgets.filter((t=>e.isSelectedOrActive(t))).map((e=>e.model.toJSON())).map((e=>(void 0!==e.metadata.deletable&&delete e.metadata.deletable,e)))}}(n||(n={}));class m extends s.NotebookModel{fromJSON(e){var t,o;let n=!0;(null===(o=null===(t=e.metadata)||void 0===t?void 0:t.kernelspec)||void 0===o?void 0:o.name)&&"dfpython3"!=e.metadata.kernelspec.name&&(n=!1),super.fromJSON(e),this.setMetadata("dfnotebook",n)}}class g extends s.NotebookModelFactory{createNew(e={}){return new m({languagePreference:e.languagePreference,sharedModel:e.sharedModel,collaborationEnabled:e.collaborationEnabled&&this.collaborative,disableDocumentWideUndoRedo:this._disableDocumentWideUndoRedo})}get name(){return"dfnotebook"}}!function(e){class t extends u.DataflowCell.ContentFactory{createCodeCell(e){return e.contentFactory||(e.contentFactory=this),new u.DataflowCodeCell(e).initializeState()}createMarkdownCell(e){return e.contentFactory||(e.contentFactory=this),new u.DataflowMarkdownCell(e).initializeState()}createRawCell(e){return e.contentFactory||(e.contentFactory=this),new u.DataflowRawCell(e).initializeState()}}e.ContentFactory=t}(l||(l={}));class v extends s.Notebook{}!function(e){class t extends l.ContentFactory{}e.ContentFactory=t}(v||(v={}));var w,C=o(67262);!function(e){class t extends v.ContentFactory{createNotebook(e){return new v(e)}}e.ContentFactory=t,e.IContentFactory=new C.Token("@dfnotebook/dfnotebook:IContentFactory","A factory object that creates new dataflow notebooks.\n    Use this if you want to create and host dataflow notebooks in your own UI elements.")}(w||(w={}));const h=new C.Token("@dfnotebook/dfnotebook:DataflowNotebookWidgetFactory","A service to create the dataflow notebook viewer.");class b extends s.NotebookWidgetFactory{}}}]);