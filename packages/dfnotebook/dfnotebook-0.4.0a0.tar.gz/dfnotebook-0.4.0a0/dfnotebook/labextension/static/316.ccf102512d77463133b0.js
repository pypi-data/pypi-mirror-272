"use strict";(self.webpackChunk_dfnotebook_dfnotebook_extension=self.webpackChunk_dfnotebook_dfnotebook_extension||[]).push([[316],{49471:(t,e,s)=>{s.d(e,{T:()=>p,m:()=>f});var i=s(77917),n=s(34651),a=s.n(n),l=(s(57826),s(28331)),r=s.n(l),o=s(70431),d=s(16381);const h={height:1600,width:1600,scale:1,tweenPrecision:1,engine:"dot",keyMode:"title",convertEqualSidedPolygons:!1,fade:!1,growEnteringEdges:!1,fit:!0,tweenPaths:!1,tweenShapes:!1,useWorker:!1,zoom:!0};class c{constructor(t,e,s){this.closeDiv=function(){this.isOpen=!1,this.depdiv.style.display="none",i.Ltv(this.parentdiv).transition().delay(100).style("height","0vh"),i.Ltv(".end_space").transition().delay(100).style("height","0vh")},this.updateOrder=function(t){this.order=t},this.setTracker=function(t){this.tracker=t,console.log(t)},this.createDepDiv=function(){let t=this;this.depdiv=document.createElement("div"),this.depdiv.setAttribute("class","dep-div container"),a()(this.parentdiv).append(this.depdiv),this.sidePanel=i.Ltv("div.dep-div").append("div").attr("id","side-panel"),this.tabular=this.sidePanel.append("div").attr("id","table").classed("card",!0),this.tabular.append("a").text("â¤“ Dot").attr("id","dot-dl").classed("btnviz",!0).classed("btnviz-primary",!0).classed("fa",!0),this.tabular.append("a").text("Toggle Sink Cells").attr("id","out-toggle").classed("btnviz",!0).classed("btnviz-primary",!0).classed("fa",!0).on("click",(function(){t.dataflow=!t.dataflow,t.startGraphCreation()})),this.tabular.append("span").text("Cell Local Variables:").classed("locals",!0),this.tabular.data(["None"]).append("span").text("None").classed("badge-pill",!0).classed("badge-danger",!0),this.svg=i.Ltv("div.dep-div").append("div").attr("id","svg-div").on("contextmenu",(function(){return!1})),this.isCreated=!0},this.setDetails=function(t){let e=this;if(a()("#"+e.activeCell+"cluster").find("polygon").toggleClass("selected",!1),e.activeCell=t,i.Ltv("#select-identifier").remove(),e.dfgraph.getCells().indexOf(e.activeCell)>-1){let t=a()("#"+e.activeCell+"cluster").find("polygon").attr("points").split(" "),s=t[1].split(","),n=Math.abs(s[1]-Number(t[0].split(",")[1]));i.Ltv("#svg-div svg g").insert("g","#a_graph0 + *").attr("id","select-identifier").append("rect").attr("x",parseInt(s[0])-3).attr("y",parseInt(s[1])).attr("height",n).attr("width","3px")}this.tracker.currentWidget.content.activeCellIndex=this.order.indexOf(t),a()("#"+t+"cluster").find("polygon").toggleClass("selected",!0),i.Ltv("#table").selectAll(".badge-pill").remove();let s=e.dfgraph.getInternalNodes(t);s.length<1&&(s=["None"]),i.Ltv("#table").selectAll("span.badge").data(s).enter().append("span").text((function(t){return t})).attr("class",(function(t){let e="badge badge-pill ";return"None"===t?e+"badge-danger":e+"badge-primary"}))},this.updateCellLists=function(){let t=this;i.Ltv("#table").selectAll(".cellid").on("click",(function(e){t.setDetails(e)}))},this.decorateCells=function(t,e,s){t=t||[],(s=s||!1)&&a()(".cluster").find("polygon").toggleClass(e,!1),t.forEach((function(t){a()("#"+t+"cluster").find("polygon").toggleClass(e,!0)}))},this.decorateCell=function(t,e,s){this.isOpen&&(t=t||"",a()("#"+t+"cluster").find("polygon").toggleClass(e,s))},this.createGraph=function(t){let e=this;t.nodes().forEach((function(e){let s=t.node(e);s.rx=s.ry=5})),e.dotgraph=r().write(t),e.graphtran=i.kYK().duration(750).ease(i.yfw),(0,o.C)("#svg-div").options(h).on("end",(function(){e.updateCellLists(),e.doneRendering=!0})).transition(e.graphtran).renderDot(e.dotgraph);let s=URL.createObjectURL(new Blob([e.dotgraph],{type:"text/plain;charset=utf-8"}));a()("#dot-dl").attr("href",s).attr("download","graph.dot"),a()("g.parentnode.cluster").each((function(){a()(this).mouseover((function(){let t=a()(this).find("text").text().substr(e.cellLabel.length,8);e.setDetails(t),e.dfgraph.getDownstreams(t).forEach((function(e){a()("#"+e.substr(0,8)+"cluster").find("polygon").toggleClass("upcell",!0),a()("g."+t+e.substr(0,8)).find("path").toggleClass("upstream",!0)})),e.dfgraph.getImmUpstreams(t).forEach((function(e){a()("#"+e.substr(0,8)+"cluster").find("polygon").toggleClass("downcell",!0),a()("g."+e.substr(0,8)+t).find("path").toggleClass("downstream",!0)}))})).on("mouseout",(function(){a()(".edge").each((function(){a()(this).find("path").toggleClass("upstream",!1).toggleClass("downstream",!1)})),a()("g.parentnode, .cluster").each((function(){a()(this).find("polygon").toggleClass("upcell",!1).toggleClass("downcell",!1)})).contextmenu((function(){return!1}))}))})),a()("g.child-node").each((function(){a()(this).mouseover((function(){a()(".viz-"+a()(this).find("title").text()).each((function(){a()(this).find("path").toggleClass("upstream",!0),a()(this).find("polygon").toggleClass("upcell",!0)}))})).mouseout((function(){a()(".viz-"+a()(this).find("title").text()).each((function(){a()(this).find("path").toggleClass("upstream",!1)})),a()(this).find("polygon").toggleClass("upcell",!1)}))})),a()("g.parentnode.cluster").on("mousedown",(function(t){1==t.which&&e.closeAndScroll()}))},this.getNodes=function(t){return this.dfgraph.getNodes(t).map((function(t){return t.length>10?t.substring(0,7)+"..":t}))},this.createNodeRelations=function(){let t=this;t.cellLinks=[],t.cellList=[],t.cellChildNums=[],t.outputNodes=[];let e=[];t.dataflow?(t.cellList=t.dfgraph.getCells(),t.cellList.forEach((function(s){t.outputNodes[s]=t.getNodes(s),e=t.outputNodes[s],t.dfgraph.getUpstreams(s).forEach((function(i){i=i.length>10?i.substring(0,7)+"..":i,e.indexOf(s)>-1?t.cellLinks.push({source:i,target:s}):t.cellLinks.push({source:i,target:s+"-Cell"})}))})),t.cellList=t.cellList.map((function(t){return{id:t}}))):(t.cellList=t.dfgraph.getCells(),t.cellList.forEach((function(s){t.outputNodes[s]=t.getNodes(s),0!=t.outputNodes[s].length?(e=t.outputNodes[s],s in t.outputNodes&&t.dfgraph.getUpstreams(s).forEach((function(i){i=i.length>10?i.substring(0,7)+"..":i,e.indexOf(s)>-1?t.cellLinks.push({source:i,target:s}):e.forEach((function(e){t.cellLinks.push({source:i,target:s+e})}))}))):delete t.outputNodes[s]})),t.cellList=Object.keys(t.outputNodes).map((function(t){return{id:t}}))),t.cellList.forEach((function(e){t.cellChildNums[e.id]=0})),t.cellLinks.forEach((function(e){t.cellChildNums[e.source]+=1}));let s=new d.Graph({compound:!0}).setGraph({compound:!0,ranksep:1,nodesep:.03,tooltip:" ",rankdir:"LR"}).setDefaultEdgeLabel((function(){return{}}));return t.cellList.forEach((function(e){t.outputNodes[e.id]&&(t.selected&&0==e.level?s.setNode("cluster_Out["+e.id+"]",{label:t.cellLabel+e.id,id:"selected",clusterLabelPos:"top",class:"parentnode cellid",shape:"box",margin:5}):s.setNode("cluster_Out["+e.id+"]",{label:t.cellLabel+e.id,id:e.id+"cluster",clusterLabelPos:"top",class:"parentnode cellid",tooltip:" ",shape:"box",margin:5}))})),Object.keys(t.outputNodes).forEach((function(e){let i="cluster_Out["+e+"]";if(t.dataflow||t.selected){let n=e+"-Cell";s.setNode(n,{label:"Cell["+e+"]",class:"child-node prompt output_prompt cellid",labelStyle:t.labelstyles,style:"invis",peripheries:0,height:0,width:0,margin:"0,0",tooltip:" ",shape:"point",id:n}),s.setParent(n,i)}t.outputNodes[e].forEach((function(n){/cluster_Out\_[a-f0-9]{8}/.test(n)?(s.setNode(e+n,{label:i,class:"child-node prompt output_prompt cellid",labelStyle:t.labelstyles,tooltip:" ",shape:"box",id:e+n,width:.2,height:.05,margin:"0.1,0.01"}),s.setParent(e+n,i)):(s.setNode(e+n,{label:n,class:"child-node prompt output_prompt cellid",labelStyle:t.labelstyles,tooltip:" ",shape:"box",id:e+n,width:.2,height:.05,margin:"0.1,0.01"}),s.setParent(e+n,i))}))})),t.cellLinks.forEach((function(t){s.hasNode(t.source)&&s.hasNode(t.target)&&s.setEdge(t.source,t.target,{class:t.source.substr(0,8)+t.target.substr(0,8)+" viz-"+t.source,id:"viz-"+t.source+t.target,lhead:"cluster_Out["+t.target.substr(0,8)+"]"})})),t.debugMode&&(console.log(t.cellList),console.log(t.outputNodes),console.log(t.cellLinks),console.log(s.children()),console.log(s.nodes()),console.log(s.edges()),console.log(r().write(s))),s},this.toggleDepView=function(){let t=this;this.isOpen?t.closeDiv():(t.isOpen=!0,i.Ltv(t.parentdiv).transition().delay(100).style("height","60vh").on("end",(function(){t.dfgraph.wasChanged&&(t.doneRendering=!1,t.startGraphCreation())})),i.Ltv(".end_space").transition().delay(100).style("height","60vh"),t.depdiv.style.display="block")},this.startGraphCreation=function(){let t=this.createNodeRelations();this.createGraph(t),this.dfgraph.wasChanged=!1},this.setGraph=function(t){this.dfgraph=t},this.isOpen=!1,this.dataflow=!0,this.selected=!1,this.doneRendering=!1,this.isCreated=!1,this.debugMode=!1,this.parentdiv=e||"div#depview",this.depdiv=null,this.sidePanel=null,this.nodespanel=null,this.svg=null,this.tabular=null,this.executePanel=null,this.labelstyles=s||"font-family: monospace; fill: #D84315; font-size: 0.85em;",this.cellLabel="",this.cellLinks=[],this.cellList=[],this.cellChildNums=[],this.outputNodes=[],this.activeCell="",this.dfgraph=t,this.graphtran=null,this.dotgraph=[]}}class u{constructor(t,e){this.setTracker=function(t){this.tracker=t},this.updateOrder=function(t){return this.order=t.map((t=>t.substring(0,8))),!0},this.reset=function(){this.svg.selectAll(".active").classed("active",!1),this.svg.selectAll(".imm").classed("imm",!1),this.svg.selectAll(".active_node").classed("active_node",!1),this.svg.selectAll(".move_left").classed("move_left",!1),this.svg.selectAll(".move_right").classed("move_right",!1),this.svg.selectAll(".hidden").classed("hidden",!1),this.svg.selectAll(".gray").classed("gray",!1),this.svg.selectAll(".joining").remove(),this.svg.selectAll(".activeedge").remove()},this.makePaths=function(t,e,s,i){let n=i?this.svgOffsetX+this.radius+this.pathOffset:this.svgOffsetX-(this.radius+this.pathOffset),a=e-t;s.append("path").classed("joining",!0).attr("d","M"+n+" "+t+"v "+a).attr("stroke-width",this.strokeWidth)},this.genDeps=function(t,e){let s=this,n=[],a=[],l=t,r=e;for(;l.length>0||r.length>0;){let t=[],e=[];s.edges.map((function(s){l.includes(s.destination)&&(t.push(s.source),n.push(s.source)),r.includes(s.source)&&(e.push(s.destination),a.push(s.destination))})),l=t,r=e}n.map((function(t){i.Ltv("#node"+t).classed("move_right",!0).classed("active",!0).classed("gray",!0)})),a.map((function(t){i.Ltv("#node"+t).classed("move_left",!0).classed("active",!0).classed("gray",!0)}))},this.elementActivate=function(t,e){let s=this,n=[],a=[];if(!e.classed("active_node")){this.reset(),e.classed("active_node",!0),t.classed("active",!0);let l=t.attr("id");l=l.substring(s.idSubstr.length,l.length);let r=s.svgOffsetX,o=0,d=s.edgeYOffset+s.offsetX*s.orderFixed.indexOf(l),h=l.substring(l.length-8,l.length),c=s.dfgraph.getImmUpstreams(h),u=s.dfgraph.getDownstreams(h);c.length>0&&u.length>0?(r=s.svgOffsetX-s.offsetActive/2,o=s.offsetActive):c.length>0?o=-s.offsetActive/2:u.length>0&&(o=s.offsetActive/2);let p="#node"+l;i.Ltv(p).append("g").attr("transform","translate(0,0)").classed("activeedge",!0).append("path").classed("source",!0).attr("d","M"+r+" "+d+"h "+o).attr("stroke-width",s.strokeWidth).attr("fill","#3b5fc0").attr("stroke","#3b5fc0"),i.Ltv("#text"+l).classed("active",!0),"cells"==s.mode?this.tracker.currentWidget.content.activeCellIndex=this.order.indexOf(l):this.tracker.currentWidget.content.activeCellIndex=this.order.indexOf(l.split(s.fixedIdentifier)[1]),this.edges.map((function(e){let r=e.source,o=e.destination;if(r==l){a.push(o);let e=i.Ltv("#node"+o).classed("move_left",!0).classed("active",!0).classed("imm",!0),n=s.edgeYOffset+s.offsetY*s.orderFixed.indexOf(o);s.makePaths(d,n,t,!0),e.selectAll("path.source").classed("hidden",!0)}if(o==l){n.push(r);let e=i.Ltv("#node"+r).classed("move_right",!0).classed("active",!0).classed("imm",!0),a=s.edgeYOffset+s.offsetY*s.orderFixed.indexOf(r);s.makePaths(a,d,t,!1),e.selectAll("path.destination").classed("hidden",!0)}}))}s.genDeps(n,a),this.svg.selectAll("g").filter((function(t){return!this.classList.contains("active")&&"svg"==this.parentElement.nodeName})).selectAll("path").classed("hidden",!0)},this.updateActiveByID=function(t){let e=null,s=null,n=this;if("nodes"==this.mode){let a=this.dfgraph.getNodes(t),l=a.length>0?a[0]:"";a.length>0&&null==a[0]&&(l=""),e=i.Ltv("#node"+l+n.fixedIdentifier+t).classed("move_right",!0).classed("active",!0),s=e.select("circle")}else e=i.Ltv("#node"+t).classed("move_right",!0).classed("active",!0),s=e.select("circle");this.elementActivate(e,s)},this.combineTags=function(t){let e=this;return t in this.outputTags?0==this.dfgraph.getNodes(t).length?[""+e.fixedIdentifier+t]:this.outputTags[t].map((s=>(s||"")+e.fixedIdentifier+t)):this.dfgraph.getNodes(t)},this.updateStates=function(){let t=this;t.svg.selectAll("rect.states").data(t.orderFixed).attr("fill",(e=>t.colormap[t.dfgraph.states[e.substring(e.length-8,e.length)]||"None"])).enter().append("rect").attr("x",t.stateOffset).attr("y",(function(e,s){return t.rectYOffset+t.offsetY*s})).attr("width",t.statesWidth).attr("height",t.statesHeight).attr("rx",t.statesRx).attr("ry",t.statesRy).attr("id",(t=>"state"+t)).attr("fill",(e=>t.colormap[t.dfgraph.states[e.substring(e.length-8,e.length)]||"None"])).classed("states",!0)},this.outTagsLength=function(t){return t in this.outputTags?0==this.outputTags[t].length?1:this.outputTags[t].length:1},this.grabOutTags=function(t,e){return t in this.outputTags?this.outputTags[t].reduce(((t,e)=>{let s=new RegExp(e);return t?t.replace(s,"OUTTAGSTARTSHERE"+e+"OUTTAGSTARTSHERE"):""}),e):e||""},this.createMinimap=function(t,e){let s=this,n=i.kYK().duration(0),l=this.svg.selectAll("circle"),r=null;r="cells"==s.mode?this.order:this.order.reduce((function(t,e){return t.concat(s.combineTags(e))}),[]);let o=l.data(r,(t=>t)).enter().append("g").attr("id",(t=>"node"+t));o.append("rect").attr("x",0).attr("y",((t,e)=>0+e*s.offsetY)).attr("width",500).attr("height",s.offsetY).attr("fill","transparent").on("click",(function(){let t=i.Ltv(this.parentNode),e=t.select("circle");s.elementActivate(t,e)})),o.append("circle").transition(n).attr("cx",this.svgOffsetX).attr("cy",((t,e)=>s.edgeYOffset+this.offsetY*e)).attr("r",this.radius),s.mapEdges(s);let d=this.order.map((t=>[t,s.grabOutTags(t,s.getCellContents(t)).split("OUTTAGSTARTSHERE").map((e=>[e,(s.outputTags[t]||[]).includes(e)]))])),h=function(){let t=i.Ltv(this).attr("id");t=t.substring(this.idSubstr.length,t.length);let e=i.Ltv("#node"+t),n=e.select("circle");s.elementActivate(e,n)};if("nodes"==s.mode){let t=d;d=s.order.reduce((function(t,e){return t.concat(s.getNodes(e).map((t=>[t?t+s.fixedIdentifier+e:"",[[t,!0]]])))}),[]);let e=0;s.svg.selectAll("rect.cells").data(s.order).enter().append("rect").classed("cells",!0).attr("x",8).attr("y",(function(t){let i=e;return e+=s.outTagsLength(t),s.rectYOffset+i*s.offsetY})).attr("width",50).attr("height",(t=>s.offsetY*s.outTagsLength(t)-s.rectYOffset)).attr("rx",s.nodesRx).attr("ry",s.nodesRy),e=0,this.svg.selectAll("text.source").data(t,(function(t){return t[0]})).each((function(t){a()(this).empty(),i.Ltv(this).selectAll("tspan").data(t[1]).enter().append("tspan").text((function(t){return t[0]?t[0]:""})).classed("outtag",(t=>t[1]))})).on("click",h).enter().append("text").on("click",h).attr("id",(t=>"text"+t[0])).classed("source",!0).attr("x",s.textOffset+s.svgOffsetX+80).attr("y",(function(t,i){let n=e,a=t[0],l=s.outTagsLength(a);return e+=l,l>1?s.offsetY+s.offsetY*n+s.offsetY/l:s.offsetY+s.offsetY*n})).on("click",h).each((function(t){i.Ltv(this).selectAll("tspan").data(t[1]).enter().append("tspan").text((function(t){return t[0]?t[0]:""})).classed("outtag",(t=>t[1]))})),this.svg.selectAll("rect.states").data(s.orderFixed).attr("fill",(t=>s.colormap[s.dfgraph.states[t.substring(t.length-8,t.length)]||"None"])).enter().append("rect").attr("x",s.stateOffset).attr("y",(function(t,e){return s.rectYOffset+s.offsetY*e})).attr("width","5px").attr("height","12px").attr("rx","2px").attr("ry","2px").attr("id",(t=>"state"+t)).attr("fill",(function(t){return s.colormap[s.dfgraph.states[t.substring(t.length-8,t.length)]||"None"]})).classed("states",!0)}this.svg.selectAll("text.labels").data(d,(function(t){return t[0]})).each((function(t){a()(this).empty(),i.Ltv(this).selectAll("tspan").data(t[1]).enter().append("tspan").text((function(t){return t[0]?t[0].length>s.textEllide?t[0].substring(0,7)+"..":t[0]:""})).classed("outtag",(t=>t[1]))})).on("click",h).enter().append("text").on("click",h).attr("id",(t=>"text"+t[0])).attr("x",this.textOffset+this.svgOffsetX).attr("y",((t,e)=>s.offsetY+this.offsetY*e)).each((function(t){a()(this).empty(),i.Ltv(this).selectAll("tspan").data(t[1]).enter().append("tspan").text((function(t){return t[0]?t[0].length>s.textEllide?t[0].substring(0,7)+"..":t[0]:""})).classed("outtag",(t=>t[1]))})).classed("labels",!0)},this.getNodes=function(t){let e=this.dfgraph.getNodes(t);return 0==e.length?[""]:e},this.mapEdges=function(t,e){let s=this;"cells"==s.mode?s.orderFixed=this.order:s.orderFixed=this.order.reduce((function(t,e){return t.concat(s.combineTags(e))}),[]);let n={};this.edges.map((function(t){let e="#node"+t.source,a="#node"+t.destination;if(e in n){if(n[e].includes(a))return;n[e].push(a)}else n[e]=[a];let l=s.svgOffsetX,r=s.edgeYOffset+s.offsetX*s.orderFixed.indexOf(t.source),o=s.svgOffsetX,d=s.edgeYOffset+s.offsetX*s.orderFixed.indexOf(t.destination);i.Ltv(e).append("g").attr("transform","translate(0,0)").attr("id","edge"+t.source).append("path").classed("source",!0).attr("d","M"+l+" "+r+"h 8").attr("stroke-width",s.strokeWidth).attr("fill","none").attr("stroke","black"),i.Ltv(a).append("g").attr("transform","translate(0,0)").attr("id","edge"+t.source).append("path").classed("destination",!0).attr("d","M"+o+" "+d+"h -8").attr("stroke-width",s.strokeWidth).attr("fill","none").attr("stroke","black")}))},this.getCellContents=function(t){let e=this;if(t in e.cells)return e.cells[t];let s=e.dfgraph.getText(t).split("\n"),i=s[s.length-1];return e.cells[t]=i||"",e.cells[t]},this.updateCells=function(){let t=this;return t.cells=Object.keys(this.dfgraph.cellContents).reduce((function(e,s){let i=t.dfgraph.cellContents[s].split("\n");return e[s]=i[i.length-1],e}),{}),t.updateOrder(t.tracker.currentWidget.model.cells.model.cells.map((t=>t.id))),!0},this.updateEdges=function(){let t=this;if("cells"==this.mode){const e=t=>t.reduce(((t,e)=>t.concat(e)),[]);let s=t.dfgraph.downlinks;t.edges=e(Object.keys(s).map((function(t){return s[t].map((function(e){return{source:t,destination:e}}))})))}else{t.edges=[];let e=t.dfgraph.getCells();t.cellLinks=[],t.outputNodes=[],e.forEach((function(e){t.outputNodes[e]=t.getNodes(e);let s=t.outputNodes[e];t.dfgraph.getUpstreams(e).forEach((function(i){let n=i.substring(0,8),a=i.substring(8,i.length);s.forEach((s=>{t.edges.push({source:a+t.fixedIdentifier+n,destination:s+t.fixedIdentifier+e})}))}))}))}return!0},this.createMiniArea=function(){(async()=>{for(;0===a()("#minisvg").height();)await new Promise((t=>setTimeout(t,100)));i.Ltv("#minimap").classed("container",!0);let t=this;this.svg=i.Ltv("#minisvg"),this.svg=this.svg.append("g"),this.svg.attr("transform","translate(0,0)"),this.toggle=i.Ltv("#minimap").append("div").attr("id","side-panel-mini"),this.tabular=this.toggle.append("div").attr("id","table").classed("card",!0);let e=this.tabular.append("label").classed("switch",!0);e.append("input").attr("type","checkbox").on("change",(function(){t.changeMode()})),e.append("span").classed("slider",!0).classed("round",!0),this.startMinimapCreation()})()},this.clearMinimap=function(){a()("#minisvg g").empty()},this.updateOutputTags=function(){let t=this;return t.outputTags={},t.dfgraph.getCells().forEach((function(e){t.outputTags[e]=t.dfgraph.getNodes(e)})),!0},this.startMinimapCreation=function(){this.updateCells()&&this.updateOutputTags()&&this.updateEdges()&&this.createMinimap()},this.changeMode=function(){let t=this;t.mode="nodes"==t.mode?"cells":"nodes",t.clearMinimap(),t.startMinimapCreation()},this.setGraph=function(t){this.dfgraph=t,this.updateOrder(this.tracker.currentWidget.model.cells.model.cells.map((t=>t.id))),this.svg&&(this.clearMinimap(),this.startMinimapCreation())},this.wasCreated=!1,this.radius=3,this.offsetX=15,this.offsetY=15,this.svgOffsetX=32,this.svgOffsetY=50,this.textOffset=40,this.stateOffset=63,this.pathOffset=8,this.edgeYOffset=10,this.strokeWidth=2,this.offsetActive=24,this.rectYOffset=4,this.statesWidth=5,this.statesHeight=12,this.nodesRx=this.nodesRy=3,this.statesRx=this.statesRy=2,this.textEllide=10,this.idSubstr="node",this.fixedIdentifier="DFELEMENT",this.cells={},this.parentdiv=e||"#minimap",this.edges=[],this.outputTags={},this.dfgraph=t||null,this.tracker=null,this.toggle=null,this.tabular=null,this.mode="nodes",this.colormap={Stale:"yellow",Fresh:"blue","Upstream Stale":"yellow",Changed:"orange",None:"grey"}}}Array.prototype.setAdd=function(t){this.indexOf(t)<0&&this.push(t)};class p{constructor({cells:t=[],nodes:e=[],uplinks:s={},downlinks:i={},internalNodes:n={},allDown:a={},cellContents:l={}}={},r){this.getText=function(t){return t in this.cellContents?this.cellContents[t]:""},this.updateOrder=function(t){console.log(t),this.cellOrder=t},this.removeCell=function(t){let e=this,s=e.cells.indexOf(t);if(s>-1&&(e.cells.splice(s,1),delete e.nodes[t],delete e.internalNodes[t],delete e.downstreamLists[t],(e.downlinks[t]||[]).forEach((function(s){s in e.uplinks&&t in e.uplinks[s]&&delete e.uplinks[s][t]})),delete e.downlinks[t],t in e.uplinks&&Object.keys(e.uplinks[t]).forEach((function(s){let i=e.downlinks[s].indexOf(t);e.downlinks[s].splice(i,1)})),delete e.uplinks[t],t in e.upstreamList)){let s=e.upstreamList[t].slice(0);delete e.upstreamList[t],s.forEach((function(t){delete e.downstreamLists[t]}))}},this.setInternalNodes=function(t,e){this.internalNodes[t]=e},this.getCells=function(){return this.cells};let o=this;this.wasChanged=!1,this.cells=t||[],this.nodes=e||[],this.uplinks=s||{},this.downlinks=i||{},this.internalNodes=n||{},this.cellContents=l||{},this.cellOrder=[],this.downstreamLists=a||{},this.upstreamList={},this.states=r||{},this.executed={},o.cells.length>1&&o.cells.forEach((function(t){o.states[t]="Stale",o.executed[t]=!1}))}updateStale(t){this.states[t]="Changed",t in this.downlinks&&this.allDownstream(t).forEach((t=>this.states[t]="Upstream Stale"))}updateFresh(t,e){let s=this;e&&!s.executed[t]||(s.states[t]="Fresh",s.executed[t]=!0,console.log(s.uplinks[t]),Object.keys(s.uplinks[t]).forEach((function(t){s.states[t]="Fresh"})),1==e&&s.allDownstream(t).forEach((function(t){s.upstreamFresh(t)&&"Upstream Stale"==s.states[t]&&(s.states[t]="Fresh")})))}upstreamFresh(t){let e=this;return Object.keys(e.getAllUpstreams(t)).reduce((function(t,s){return t&&"Fresh"==e.states[s]}),!0)}updateGraph(t,e,s,i,n,a,l){let r=this;r.cells=t,r.nodes[n]=e||[],n in r.uplinks&&Object.keys(r.uplinks[n]).forEach((function(t){r.downlinks[t]=[]})),r.uplinks[n]=s,r.downlinks[n]=i||[],r.internalNodes[n]=l,r.updateDepLists(a,n),r.updateFresh(n,!1)}allDownstream(t){let e=this,s=[],i=[],n=(this.downlinks[t]||[]).slice(0);for(;n.length>0;){let t=n.pop();if(s.setAdd(t),i.setAdd(t),t in e.downstreamLists)e.downstreamLists[t].forEach((function(t){i.setAdd(t),s.setAdd(t)}));else if(t in e.downlinks)e.downlinks[t].forEach((function(t){s.indexOf(t)<0&&n.push(t)}));else{let e=i.indexOf(t);i.splice(e,1)}}return e.downstreamLists[t]=i,i}allUpstreamCellIds(t){let e=this.getImmUpstreams(t),s=[];for(;e.length>0;){let t=e.pop()||"";s.setAdd(t),e=e.concat(this.getImmUpstreams(t))}return s}updateDownLinks(t){let e=this;t.forEach((function(t){let s=t.key.substr(0,8);e.downlinks[s]=t.data,s in e.cellContents&&t.data&&(e.downlinks[s]=t.data)})),e.downstreamLists={}}updateCellContents(t){this.cellContents=t}updateDepLists(t,e){t.length>0&&(this.upstreamList[e]=t)}getAllUpstreams(t){return this.upstreamList[t]}getUpstreams(t){let e=this;return Object.keys(e.uplinks[t]||[]).reduce((function(s,i){let n=e.uplinks[t][i].map((function(t){return i===t?t:i+t}))||[];return s.concat(n)}),[])}getImmUpstreams(t){return t in this.uplinks?Object.keys(this.uplinks[t]):[]}getImmUpstreamNames(t){let e=[],s=this;return this.getImmUpstreams(t).forEach((function(i){Array.prototype.push.apply(e,s.uplinks[t][i])})),e}getImmUpstreamPairs(t){let e=[],s=this;return void 0!==t&&this.getImmUpstreams(t.toString()).forEach((function(i){Array.prototype.push.apply(e,s.uplinks[t][i].map((function(t){return[t,i]})))})),e}getDownstreams(t){return this.downlinks[t]}getInternalNodes(t){return this.internalNodes[t]||[]}getNodes(t){let e=this;return t in e.nodes&&(e.nodes[t]||[]).length>0?e.nodes[t]:[]}}const f=new class{constructor(t){this.getProperty=function(t){return t in this.graphs?this.graphs[t]:""},this.setTracker=function(t){this.tracker=t,this.minimap.setTracker(this.tracker),this.depview.setTracker(this.tracker)},this.updateGraph=function(t){"None"!=t&&(this.currentGraph=t,this.depview.dfgraph=this.graphs[t],this.minimap.setGraph(this.graphs[t]),this.updateDepViews(!0))},this.updateActive=function(t,e){this.activeID=t||"none",this.previousActive=e||"none",this.miniWidget.isOpen&&this.minimap.updateActiveByID(t)},this.updateActiveGraph=function(){var t;this.currentGraph=(null===(t=this.tracker.currentWidget.sessionContext.session)||void 0===t?void 0:t.id)||"None",this.depview.dfgraph=this.graphs[this.currentGraph],this.minimap.setGraph(this.graphs[this.currentGraph]),this.updateDepViews(!0,!1,!0)},this.markStale=function(t){this.updateActiveGraph(),this.currentGraph in this.graphs&&(this.graphs[this.currentGraph].updateStale(t),this.miniWidget.isOpen&&this.minimap.updateStates())},this.revertStale=function(t){this.graphs[this.currentGraph].updateFresh(t,!0),this.miniWidget.isOpen&&this.minimap.updateStates()},this.getStale=function(t){return this.graphs[this.currentGraph].states[t]},this.getActive=function(){return this.previousActive},this.getText=function(t){return this.updateActiveGraph(),this.currentGraph in this.graphs?this.graphs[this.currentGraph].cellContents[t]:""},this.updateOrder=function(t){if(this.updateActiveGraph(),!(this.currentGraph in this.graphs))return;this.graphs[this.currentGraph].updateOrder(t);let e=t.map((t=>t.replace(/-/g,"").substr(0,8)));this.minimap.updateOrder(e),this.depview.updateOrder(e),this.updateDepViews(!0,!0)},this.updateDepViews=function(t,e=!1,s=!1){if(this.miniWidget.isOpen){if(s)return;t&&this.minimap.clearMinimap(),this.minimap.startMinimapCreation()}if(this.depWidget.isOpen&&!e)if(t)this.depview.startGraphCreation();else{let t=this.depview.createNodeRelations(this.depview.globaldf,this.depview.globalselect);this.depview.createGraph(t)}},this.graphs=t||{},this.currentGraph="None",this.depview=new c,this.minimap=new u,this.previousActive="None"}}}}]);