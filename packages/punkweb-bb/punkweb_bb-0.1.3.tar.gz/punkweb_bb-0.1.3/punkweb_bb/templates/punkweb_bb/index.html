{% extends 'punkweb_bb/base.html' %}

{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'punkweb_bb/css/index.css' %}" />
<link rel="stylesheet" href="{% static 'punkweb_bb/css/shoutbox.css' %}" />
{% endblock %}

{% block extra_script %}
<script src="{% static 'punkweb_bb/js/shoutbox.js' %}"></script>
{% endblock %}

{% block content %}

<div class="index">
  <div class="index__main">
    <div class="index__categories">
      {% if punkweb_bb.settings.SHOUTBOX_ENABLED|default:True %}
      {% include 'punkweb_bb/shoutbox/shoutbox.html' %}
      {% endif %}
      {% for category in categories %}
      <div id="{{category.slug}}.{{category.order}}" class="pw-card fluid margin">
        <div class="pw-table-container">
          <table class="pw-table">
            <colgroup>
              <col span="1">
              <col span="1" width="96px">
              <col span="1" width="96px">
              <col span="1" width="320px">
            </colgroup>
            <thead>
              <tr>
                <th><a href="{{category.get_absolute_url}}">{{category.name}}</a></th>
                <th>Threads</th>
                <th>Posts</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for subcategory in category.subcategories.all %}
              <tr>
                <td>
                  <a href="{{subcategory.get_absolute_url}}" title="{{subcategory.name}}">{{subcategory.name}}</a>
                  <div>
                    {{subcategory.description}}
                  </div>
                </td>
                <td>{{subcategory.thread_count}}</td>
                <td>{{subcategory.post_count}}</td>
                <td>
                  {% if subcategory.latest_thread %}
                  {% if subcategory.latest_thread.latest_post %}
                  <div class="subcategory__latestThread">
                    {% if subcategory.latest_thread.latest_post.user.profile.image %}
                    <img class="pw-avatar xs" src="{{subcategory.latest_thread.latest_post.user.profile.image.url}}" />
                    {% else%}
                    <img class="pw-avatar xs" src="{% static 'punkweb_bb/img/default-profile-image.png' %}" />
                    {% endif %}
                    <div class="subcategory__latestThread__info">
                      <a class="subcategory__latestThread__info__title"
                        href="{{subcategory.latest_thread.get_absolute_url}}" title="{{subcategory.latest_thread.title}}">
                        {{subcategory.latest_thread.title}}
                      </a>
                      <div>
                        <time datetime="{{subcategory.latest_thread.latest_post.created_at|date:'c'}}">
                          {{subcategory.latest_thread.latest_post.created_at|date:'M j, Y'}} at
                          {{subcategory.latest_thread.latest_post.created_at|date:'g:i A'}}
                        </time>
                        •
                        <a href="{% url 'punkweb_bb:profile' subcategory.latest_thread.latest_post.user.id %}">
                          {{subcategory.latest_thread.latest_post.user.username}}
                        </a>
                      </div>
                    </div>
                  </div>
                  {% else %}
                  <div class="subcategory__latestThread">
                    {% if subcategory.latest_thread.user.profile.image %}
                    <img class="pw-avatar xs" src="{{subcategory.latest_thread.user.profile.image.url}}" />
                    {% else%}
                    <img class="pw-avatar xs" src="{% static 'punkweb_bb/img/default-profile-image.png' %}" />
                    {% endif %}
                    <div class="subcategory__latestThread__info">
                      <a class="subcategory__latestThread__info__title"
                        href="{{subcategory.latest_thread.get_absolute_url}}" title="{{subcategory.latest_thread.title}}">
                        {{subcategory.latest_thread.title}}
                      </a>
                      <div>
                        <time datetime="{{subcategory.latest_thread.created_at|date:'c'}}">
                          {{subcategory.latest_thread.created_at|date:'M j, Y'}} at
                          {{subcategory.latest_thread.created_at|date:'g:i A'}}
                        </time>
                        •
                        <a href="{% url 'punkweb_bb:profile' subcategory.latest_thread.user.id %}">
                          {{subcategory.latest_thread.user.username}}
                        </a>
                      </div>
                    </div>
                  </div>
                  {% endif %}
                  {% else %}
                  No threads
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="index__sidebar">
      <div class="pw-card fluid">
        <div class="pw-card-header">Recent threads</div>
        <div class="index__recentThreads__content">
          {% for thread in recent_threads %}
          <div class="index__recentThreads__thread">
            {% if thread.user.profile.image %}
            <img class="pw-avatar xs" src="{{thread.user.profile.image.url}}" />
            {% else%}
            <img class="pw-avatar xs" src="{% static 'punkweb_bb/img/default-profile-image.png' %}" />
            {% endif %}
            <div class="index__recentThreads__thread__info">
              <a class="index__recentThreads__thread__info__title" href="{{thread.get_absolute_url}}"
                title="{{thread.title}}">
                {{thread.title}}
              </a>
              <div>
                <time datetime="{{thread.created_at|date:'c'}}">
                  {{thread.created_at|date:'M j, Y'}} at
                  {{thread.created_at|date:'g:i A'}}
                </time>
                •
                <a href="{% url 'punkweb_bb:profile' thread.user.id %}">
                  {{thread.user.username}}
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      <div class="pw-card fluid margin">
        <div class="pw-card-header">Statistics</div>
        <div class="index__statistics__content">
          <div class="index__statistics__list">
            <div class="index__statistics__row">
              <div class="index__statistics__label">Total threads:</div>
              <div class="index__statistics__value">
                {{thread_count}}
              </div>
            </div>
            <div class="index__statistics__row">
              <div class="index__statistics__label">Total posts:</div>
              <div class="index__statistics__value">{{post_count}}</div>
            </div>
            <div class="index__statistics__row">
              <div class="index__statistics__label">Total members:</div>
              <div class="index__statistics__value">{{users|length}}</div>
            </div>
            {% if newest_user %}
            <div class="index__statistics__row">
              <div class="index__statistics__label">Newest member:</div>
              <div class="index__statistics__value">
                <a href="{% url 'punkweb_bb:profile' newest_user.id %}">
                  {{newest_user.username}}
                </a>
              </div>
            </div>
            {% endif %}
            <div class="index__statistics__row">
              <div class="index__statistics__label">Members online:</div>
              <div class="index__statistics__value">{{users_online|length}}</div>
            </div>
            <div class="index__statistics__row">
              <div class="index__statistics__label">Staff online:</div>
              <div class="index__statistics__value">{{staff_online|length}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}