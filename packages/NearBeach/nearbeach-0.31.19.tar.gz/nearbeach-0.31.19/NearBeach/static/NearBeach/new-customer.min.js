"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[6023],{3450:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var s=a(6252);const o={class:"card"},i={class:"card-body"},r=(0,s._)("h1",null,"New Customer",-1),l=(0,s._)("hr",null,null,-1),n=(0,s._)("hr",null,null,-1),m={class:"row"},u=(0,s._)("div",{class:"col-md-4"},[(0,s._)("strong",null,"Customer Organisation"),(0,s._)("p",{class:"text-instructions"}," This field is optional. If this customer does not have any organisations attached, it will treat this customer as a freelancer. ")],-1),d={class:"col-md-8"},c={class:"form-group col-sm-8"},h=(0,s._)("label",null,"Organisation:",-1),g=(0,s._)("hr",null,null,-1),p={class:"row submit-row"},v={class:"col-md-12"};a(3138);var M=a(5705),_=a(760),f=a(624),N=a(160),w=a(2001);const C={name:"NewCustomer",setup:()=>({v$:(0,M.ZP)()}),components:{NewCustomerForm:N.Z,NSelect:w.Z},props:{organisationName:{type:String,default:""},rootUrl:{type:String,default:"/"},theme:{type:String,default:""},titleList:{type:Array,default:()=>[]}},mixins:[f.Z],data:()=>({customerEmailModel:"",customerFirstNameModel:"",customerLastNameModel:"",flagValidationCheck:!1,organisationFixList:[],organisationModel:"",searchTimeout:"",titleModel:[]}),validations:()=>({customerEmailModel:{required:_.C1,email:_.Do},customerFirstNameModel:{required:_.C1},customerLastNameModel:{required:_.C1},titleModel:{required:_.C1}}),methods:{fetchOptions(e,t){""!==this.searchTimeout&&clearTimeout(this.searchTimeout),e.length>=3&&(this.searchTimeout=setTimeout((()=>{this.getOrganisationData(e,t)}),500))},getOrganisationData(e,t){const a=new FormData;a.set("search",e),this.axios.post(`${this.rootUrl}search/organisation/data/`,a).then((e=>{const t=e.data;this.organisationFixList=t.map((e=>({value:e.pk,label:e.fields.organisation_name})))})).catch((e=>{this.$store.dispatch("newToast",{header:"Error Getting Organisation Data",message:`Error getting organisation data. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},submitNewCustomer:async function(){if(this.flagValidationCheck=!0,setTimeout((()=>{this.flagValidationCheck=!1}),100),this.v$.$touch(),!await this.v$.$validate())return void this.$store.dispatch("newToast",{header:"Error submitting new customer",message:`Sorry, we had an submitting new customer. Error -> ${error}`,extra_classes:"bg-danger",delay:0});const e=new FormData;e.set("customer_title",this.titleModel),e.set("customer_first_name",this.customerFirstNameModel),e.set("customer_last_name",this.customerLastNameModel),e.set("customer_email",this.customerEmailModel),""!==this.organisationModel&&null!==this.organisationModel&&e.set("organisation",this.organisationModel),this.axios.post(`${this.rootUrl}new_customer/save/`,e).then((e=>{window.location.href=e.data})).catch((e=>{this.$store.dispatch("newToast",{header:"Error submitting new customer",message:`Sorry, we had an submitting new customer. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},updateCustomerData(e){this[e.field]=e.value}},mounted(){this.$nextTick((()=>{this.getOrganisationData("","")}))}},b=(0,a(3744).Z)(C,[["render",function(e,t,a,M,_,f){const N=(0,s.up)("new-customer-form"),w=(0,s.up)("n-select"),C=(0,s.up)("n-config-provider");return(0,s.wg)(),(0,s.j4)(C,{theme:e.getTheme(a.theme)},{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s._)("div",i,[(0,s.kq)(" HEADER "),r,l,(0,s.Uk)(" New Customer Form "),(0,s.Wm)(N,{"organisation-name":a.organisationName,"title-list":a.titleList,"flag-validation-check":_.flagValidationCheck,onUpdate_customer_data:t[0]||(t[0]=e=>f.updateCustomerData(e))},null,8,["organisation-name","title-list","flag-validation-check"]),(0,s.kq)(" CUSTOMER ORGANISATION "),n,(0,s._)("div",m,[u,(0,s._)("div",d,[(0,s._)("div",c,[h,(0,s.Wm)(w,{options:_.organisationFixList,filterable:"",placeholder:"Search Organisations",onSearch:f.fetchOptions,value:_.organisationModel,"onUpdate:value":t[1]||(t[1]=e=>_.organisationModel=e),label:"organisation_name",class:"get-stakeholders"},null,8,["options","onSearch","value"])])])]),(0,s.kq)(" REMEMBER TO ADD IN USER PERMISSIONS HERE!! "),(0,s.kq)(" Submit Button "),g,(0,s._)("div",p,[(0,s._)("div",v,[(0,s._)("a",{href:"javascript:void(0)",class:"btn btn-primary save-changes",onClick:t[2]||(t[2]=(...e)=>f.submitNewCustomer&&f.submitNewCustomer(...e))},"Submit Customer")])])])])])),_:1},8,["theme"])}]])},160:(e,t,a)=>{a.d(t,{Z:()=>N});var s=a(6252),o=a(9963);const i={class:"row"},r=(0,s._)("div",{class:"col-md-4"},[(0,s._)("strong",null,"New Customer"),(0,s._)("p",{class:"text-instructions"}," Please fill out the following details. "),(0,s._)("strong",null,"Please Note:"),(0,s._)("p",{class:"text-instructions"}," Customers do not go through a duplication process. Please search for the potential customer first before adding them into NearBeach. ")],-1),l={class:"col-md-8"},n={class:"row"},m={class:"form-group col-sm-3"},u={class:"form-group col-sm-4"},d={class:"form-group col-sm-5"},c=(0,s._)("br",null,null,-1),h={class:"form-group col-sm-8"},g=(0,s._)("br",null,null,-1);var p=a(2001),v=a(5705),M=a(760),_=a(7939);const f={name:"NewCustomerForm",setup:()=>({v$:(0,v.ZP)()}),components:{NSelect:p.Z,ValidationRendering:_.Z},props:{flagValidationCheck:{type:Boolean,default:!1},organisationName:{type:String,default:""},titleList:{type:Array,default:()=>[]}},data:()=>({customerEmailModel:"",customerFirstNameModel:"",customerLastNameModel:"",organisationModel:{},searchTimeout:"",titleFixList:[],titleModel:[]}),validations:{customerEmailModel:{required:M.C1,email:M.Do},customerFirstNameModel:{required:M.C1},customerLastNameModel:{required:M.C1},titleModel:{required:M.C1}},methods:{},watch:{customerEmailModel(){this.$emit("update_customer_data",{field:"customerEmailModel",value:this.customerEmailModel})},customerFirstNameModel(){this.$emit("update_customer_data",{field:"customerFirstNameModel",value:this.customerFirstNameModel})},customerLastNameModel(){this.$emit("update_customer_data",{field:"customerLastNameModel",value:this.customerLastNameModel})},flagValidationCheck(){this.flagValidationCheck&&this.v$.$touch()},titleModel(){this.$emit("update_customer_data",{field:"titleModel",value:this.titleModel})}},mounted(){this.titleFixList=this.titleList.map((e=>({value:e.pk,label:e.fields.title})))}},N=(0,a(3744).Z)(f,[["render",function(e,t,a,p,v,M){const _=(0,s.up)("validation-rendering"),f=(0,s.up)("n-select");return(0,s.wg)(),(0,s.iD)("div",i,[r,(0,s._)("div",l,[(0,s.kq)(" CUSTOMER DETAILS "),(0,s._)("div",n,[(0,s._)("div",m,[(0,s._)("label",null,[(0,s.Uk)(" Title: "),(0,s.Wm)(_,{"error-list":p.v$.titleModel.$errors},null,8,["error-list"])]),(0,s.Wm)(f,{options:v.titleFixList,label:"title",placeholder:"",value:v.titleModel,"onUpdate:value":t[0]||(t[0]=e=>v.titleModel=e)},null,8,["options","value"])]),(0,s._)("div",u,[(0,s._)("label",null,[(0,s.Uk)(" First Name: "),(0,s.Wm)(_,{"error-list":p.v$.customerFirstNameModel.$errors},null,8,["error-list"])]),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>v.customerFirstNameModel=e)},null,512),[[o.vModelText,v.customerFirstNameModel]])]),(0,s._)("div",d,[(0,s._)("label",null,[(0,s.Uk)(" Last Name: "),(0,s.Wm)(_,{"error-list":p.v$.customerLastNameModel.$errors},null,8,["error-list"])]),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>v.customerLastNameModel=e)},null,512),[[o.vModelText,v.customerLastNameModel]])])]),c,(0,s.kq)(" Customer Email "),(0,s._)("div",h,[(0,s._)("label",null,[(0,s.Uk)(" Email: "),(0,s.Wm)(_,{"error-list":p.v$.customerEmailModel.$errors},null,8,["error-list"])]),(0,s.wy)((0,s._)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=e=>v.customerEmailModel=e)},null,512),[[o.vModelText,v.customerEmailModel]])]),g])])}]])},7939:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(6252),o=a(3577);const i={name:"ValidationRendering",props:{errorList:{type:Array,default:()=>[]}}},r=(0,a(3744).Z)(i,[["render",function(e,t,a,i,r,l){return(0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.errorList,(e=>((0,s.wg)(),(0,s.iD)("span",{class:"error",key:e.$uid},(0,o.toDisplayString)(e.$message),1)))),128)}]])},624:(e,t,a)=>{a.d(t,{Z:()=>o});var s=a(7449);const o={data:()=>({darkTheme:s.$}),methods:{getTheme:e=>"dark"===e?s.$:null}}}}]);