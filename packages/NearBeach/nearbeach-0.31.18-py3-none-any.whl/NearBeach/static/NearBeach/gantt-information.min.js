"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[8902],{1331:(t,e,a)=>{a.r(e),a.d(e,{default:()=>C});var s=a(641),d=a(2124),i=a(6285),n=a(33);const r={class:"gantt-header"},o=(0,s.Fv)('<div class="gantt-header--information"><div class="gantt-header--title">Object Title</div><div class="gantt-header--start-date">Start Date</div><div class="gantt-header--end-date">End Date</div><div class="gantt-header--status">Status</div></div>',1),l={class:"gantt-header--dates"},h={class:"dayDate"},u={class:"dayText"},c={name:"RenderGanttDaysHeader",props:{},data:()=>({dateDictionary:{0:"S",1:"M",2:"T",3:"W",4:"T",5:"F",6:"S"}}),computed:{...(0,d.L8)({deltaDays:"getDeltaDays",endDateGantt:"getEndDateGantt",startDateGantt:"getStartDateGantt"})},methods:{getDayDate(t){const e=24*t*60*60*1e3,a=new Date(this.startDateGantt+e);return this.dateDictionary[a.getDay()]},getDayText(t){const e=24*t*60*60*1e3;return new Date(this.startDateGantt+e).getDate()}}};var m=a(6262);const D=(0,m.A)(c,[["render",function(t,e,a,d,i,c){return(0,s.uX)(),(0,s.CE)("div",r,[o,(0,s.Lk)("div",l,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.deltaDays,(t=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"gantt-header--date"},[(0,s.Lk)("div",h,(0,n.toDisplayString)(c.getDayDate(t)),1),(0,s.Lk)("div",u,(0,n.toDisplayString)(c.getDayText(t)),1)])))),128))])])}]]),g={class:"gantt-header"},p=(0,s.Lk)("div",{class:"gantt-header--information"},null,-1),S={class:"gantt-header--months"},y={name:"RenderGanttMonthlyHeader",props:{},data:()=>({monthArray:[],monthDictionary:{0:"Jan",1:"Feb",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"}}),computed:{...(0,d.L8)({deltaDays:"getDeltaDays",endDateGantt:"getEndDateGantt",startDateGantt:"getStartDateGantt"})},watch:{deltaDays(){this.generateHeader()}},methods:{generateHeader(){this.monthArray=[];let t=new Date(this.startDateGantt),e=new Date(this.endDateGantt),a=t,s=e,d=!0,i=0;for(;d;){var n=0;a.getMonth()===e.getMonth()?(d=!1,n=Math.round((e.getTime()-a.getTime())/864e5)):(s=11===a.getMonth()?new Date(a.getFullYear()+1,0,1):new Date(a.getFullYear(),a.getMonth()+1,1),n=Math.round((s.getTime()-a.getTime())/864e5)),this.monthArray.push({index:i,delta:n,width:35*n,month:this.monthDictionary[a.getMonth()],year:a.getFullYear()}),i+=1,a=s}}}},b=(0,m.A)(y,[["render",function(t,e,a,d,i,r){return(0,s.uX)(),(0,s.CE)("div",g,[p,(0,s.Lk)("div",S,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(this.monthArray,(t=>((0,s.uX)(),(0,s.CE)("div",{key:t.index,class:"gantt-header--month",style:(0,n.normalizeStyle)(`width: ${t.width}px`)},(0,n.toDisplayString)(t.month)+" "+(0,n.toDisplayString)(t.year),5)))),128))])])}]]),I={class:"gantt-row"},v={class:"gantt-row--information"},w={class:"gantt-row--title"},_={class:"gantt-row--start-date"},j={class:"gantt-row--end-date"},E={class:"gantt-row--status"},T={class:"gantt-row--render"},f={class:"gantt-row--render-bar"};var G=a(8105),O=a(1080);const k={name:"RenderGanttRow",props:{endDate:{type:Number,default:0},higherOrderStatus:{type:String,default:""},index:{type:Number,default:0},objectId:{type:Number,default:0},objectType:{type:String,default:""},startDate:{type:Number,default:0},statusId:{type:Number,default:0},title:{type:String,default:""}},components:{NDatePicker:G.A,NSelect:O.A},data(){return{localEndDate:this.endDate,localStartDate:this.startDate,localStatusId:this.statusId,statusList:[]}},watch:{endDate(t){this.localEndDate=t},startDate(t){this.localStartDate=t},statusId(t){this.localStatusId=t}},computed:{...(0,d.L8)({rootUrl:"getRootUrl",startDateGantt:"getStartDateGantt"}),barWidth(){return 35*Math.ceil((this.localEndDate-this.localStartDate)/864e5)},spacerWidth(){return 35*Math.floor((this.localStartDate-this.startDateGantt)/864e5)}},methods:{getStatusList(){this.statusList=this.$store.getters.getGanttStatusList(this.objectType)},modifiedEndDate(){this.localEndDate<this.localStartDate&&(this.localStartDate=this.localEndDate-864e5),this.updateGanttData()},modifiedStartDate(){this.localStartDate>this.localEndDate&&(this.localEndDate=this.localStartDate+864e5),this.updateGanttData()},mouseDown(t){this.$emit("mouse_down",{mdClientXInitial:t.clientX,mdHigherOrderStatus:this.higherOrderStatus,mdIndex:this.index,mdObjectId:this.objectId,mdObjectType:this.objectType,mdColumn:t.target.dataset.column,mdEndDateInitial:this.endDate,mdStartDateInitial:this.startDate,mdStatus:this.status,mdStatusId:this.statusId,mdTitle:this.title})},updateGanttData(){this.$store.dispatch("updateGanttChartSingleRow",{index:this.index,value:{end_date:this.localEndDate,higher_order_status:this.higherOrderStatus,object_id:this.objectId,object_type:this.objectType,start_date:this.localStartDate,status_id:this.localStatusId,title:this.title}}),this.$nextTick((()=>{const t=new FormData;t.set("status_id",this.localStatusId);const e=new Date(this.localEndDate),a=new Date(this.localStartDate);t.set("end_date",e.toISOString()),t.set("start_date",a.toISOString()),this.axios.post(`${this.rootUrl}gantt_data/${this.objectType}/${this.objectId}/update_data/`,t).catch((t=>{this.$store.dispatch("newToast",{header:"Error Updating the Object",message:`Sorry, we could not update the object's information. Error -> ${t}`,extra_classes:"bg-danger",delay:0})}))}))},updateStatus(t){this.localStatusId=t,this.updateGanttData()}},mounted(){this.getStatusList()}},x=(0,m.A)(k,[["render",function(t,e,a,d,i,r){const o=(0,s.g2)("n-date-picker"),l=(0,s.g2)("n-select");return(0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",v,[(0,s.Lk)("div",w,(0,n.toDisplayString)(a.title),1),(0,s.Lk)("div",_,[(0,s.bF)(o,{value:i.localStartDate,"onUpdate:value":[e[0]||(e[0]=t=>i.localStartDate=t),r.modifiedStartDate],type:"datetime"},null,8,["value","onUpdate:value"])]),(0,s.Lk)("div",j,[(0,s.bF)(o,{value:i.localEndDate,"onUpdate:value":[e[1]||(e[1]=t=>i.localEndDate=t),r.modifiedEndDate],type:"datetime"},null,8,["value","onUpdate:value"])]),(0,s.Lk)("div",E,[(0,s.bF)(l,{value:i.localStatusId,"onUpdate:value":e[2]||(e[2]=t=>i.localStatusId=t),options:i.statusList,"on-update-value":r.updateStatus},null,8,["value","options","on-update-value"])])]),(0,s.Lk)("div",T,[(0,s.Lk)("div",f,[(0,s.Lk)("div",{class:"gantt-row--spacer",style:(0,n.normalizeStyle)(`width: ${r.spacerWidth}px`)},null,4),(0,s.Lk)("div",{class:"gantt-row--bar",style:(0,n.normalizeStyle)(`width: ${r.barWidth}px`)},[(0,s.Lk)("div",{class:"gantt-row--bar-start","data-column":"start",onMousedown:e[3]||(e[3]=(...t)=>r.mouseDown&&r.mouseDown(...t))},null,32),(0,s.Lk)("div",{class:"gantt-row--bar-middle","data-column":"middle",onMousedown:e[4]||(e[4]=(...t)=>r.mouseDown&&r.mouseDown(...t))},null,32),(0,s.Lk)("div",{class:"gantt-row--bar-end","data-column":"end",onMousedown:e[5]||(e[5]=(...t)=>r.mouseDown&&r.mouseDown(...t))},null,32)],4)])])])}]]);var L=a(9827);const M={name:"GanttChart",components:{RenderGanttRow:x,RenderGanttDaysHeader:D,RenderGanttMonthlyHeader:b},props:{destination:{type:String,default:""},ganttEndDate:{type:String,default:""},ganttStartDate:{type:String,default:""},locationId:{type:Number,default:0},rootUrl:{type:String,default:"/"},theme:{type:String,default:"light"},userLevel:{type:Number,default:0}},data:()=>({isMouseDown:!1,mdClientXInitial:0,mdIndex:0,mdObjectId:0,mdObjectType:"",mdColumn:"",mdEndDateInitial:0,mdHigherOrderStatus:"",mdStartDateInitial:0,mdStatus:"",mdTitle:""}),mixins:[L.A],computed:{...(0,d.L8)({ganttChartData:"getGanttChartData"})},methods:{initialiseData(){""!==this.destination&&0!==this.locationId&&this.axios.post(`${this.rootUrl}gantt_data/${this.destination}/${this.locationId}/get_data/`).then((t=>{const e=i.c9.fromISO(this.ganttEndDate),a=i.c9.fromISO(this.ganttStartDate);this.$store.commit({type:"updateGanttStatusList",ganttStatusList:t.data.status_results}),this.$store.dispatch("initialiseGanttChartData",{ganttChartData:t.data.object_results,endDateGantt:e.ts,startDateGantt:a.ts})})).catch((t=>{this.$store.dispatch("newToast",{header:"Error fetching Gantt Data",message:`Can not retrieve gantt data. Error -> ${t}`,extra_classes:"bg-danger",delay:0})}))},mouseDown(t){this.mdClientXInitial=t.mdClientXInitial,this.mdHigherOrderStatus=t.mdHigherOrderStatus,this.mdIndex=t.mdIndex,this.mdObjectId=t.mdObjectId,this.mdObjectType=t.mdObjectType,this.mdColumn=t.mdColumn,this.mdEndDateInitial=t.mdEndDateInitial,this.mdStartDateInitial=t.mdStartDateInitial,this.mdStatus=t.mdStatus,this.mdStatusId=t.mdStatusId,this.mdTitle=t.mdTitle,this.isMouseDown=!0},mouseLeave(t){t.preventDefault(),this.isMouseDown=!1,0!==this.mdObjectId&&this.$nextTick((()=>{this.updateGanttData()}))},mouseMove(t){if(t.preventDefault(),matchMedia("(hover: none)").matches)return;if(!0!==this.isMouseDown)return;const e=t.clientX,a=864e5*Math.floor((e-this.mdClientXInitial)/35);if(!(this.mdStartDateInitial+a<new Date(this.ganttStartDate).getTime()||this.mdEndDateInitial+a>new Date(this.ganttEndDate).getTime()))switch(this.mdColumn){case"end":this.updateEnd(a);break;case"middle":this.updateMiddle(a);break;case"start":this.updateStart(a)}},mouseUp(t){t.preventDefault(),this.isMouseDown=!1,0!==this.mdObjectId&&this.$nextTick((()=>{this.updateGanttData()}))},updateEnd(t){const e=new Date(this.mdEndDateInitial+t);this.mdEndDateInitial+t<=this.mdStartDateInitial||this.$store.dispatch("updateGanttChartSingleRow",{index:this.mdIndex,value:{end_date:e.getTime(),higher_order_status:this.mdHigherOrderStatus,object_id:this.mdObjectId,object_type:this.mdObjectType,start_date:this.mdStartDateInitial,status_id:this.mdStatusId,title:this.mdTitle}})},updateGanttData(){const t=this.$store.getters.getGanttChartDataSingleRow(this.mdIndex),e=new FormData;e.set("status_id",t.status_id);const a=new Date(t.end_date),s=new Date(t.start_date);e.set("end_date",a.toISOString()),e.set("start_date",s.toISOString()),this.axios.post(`${this.rootUrl}gantt_data/${t.object_type}/${t.object_id}/update_data/`,e).catch((t=>{this.$store.dispatch("newToast",{header:"Error Updating the Object",message:`Sorry, we could not update the object's information. Error -> ${t}`,extra_classes:"bg-danger",delay:0})})),this.mdObjectId=0},updateMiddle(t){const e=new Date(this.mdEndDateInitial+t),a=new Date(this.mdStartDateInitial+t);this.$store.dispatch("updateGanttChartSingleRow",{index:this.mdIndex,value:{end_date:e.getTime(),higher_order_status:this.mdHigherOrderStatus,object_id:this.mdObjectId,object_type:this.mdObjectType,start_date:a.getTime(),status_id:this.mdStatusId,title:this.mdTitle}})},updateStart(t){const e=new Date(this.mdStartDateInitial+t);this.mdStartDateInitial+t>=this.mdEndDateInitial||this.$store.dispatch("updateGanttChartSingleRow",{index:this.mdIndex,value:{end_date:this.mdEndDateInitial,higher_order_status:this.mdHigherOrderStatus,object_id:this.mdObjectId,object_type:this.mdObjectType,start_date:e.getTime(),status_id:this.mdStatusId,title:this.mdTitle}})}},mounted(){this.initialiseData()}},C=(0,m.A)(M,[["render",function(t,e,a,d,i,n){const r=(0,s.g2)("render-gantt-monthly-header"),o=(0,s.g2)("render-gantt-days-header"),l=(0,s.g2)("render-gantt-row"),h=(0,s.g2)("n-config-provider");return(0,s.uX)(),(0,s.Wv)(h,{theme:t.getTheme(a.theme)},{default:(0,s.k6)((()=>[(0,s.Lk)("div",{class:"gantt-chart",onMouseup:e[0]||(e[0]=(...t)=>n.mouseUp&&n.mouseUp(...t)),onMouseleave:e[1]||(e[1]=(...t)=>n.mouseLeave&&n.mouseLeave(...t)),onMousemove:e[2]||(e[2]=(...t)=>n.mouseMove&&n.mouseMove(...t))},[(0,s.bF)(r),(0,s.bF)(o),(0,s.Q3)(" RENDER EACH GANTT ROW"),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.ganttChartData,((t,e)=>((0,s.uX)(),(0,s.Wv)(l,{key:e,"end-date":t.end_date,index:e,"object-id":t.object_id,"object-type":t.object_type,"higher-order-status":t.higher_order_status,"start-date":t.start_date,"status-id":t.status_id,title:t.title,onMouse_down:n.mouseDown},null,8,["end-date","index","object-id","object-type","higher-order-status","start-date","status-id","title","onMouse_down"])))),128))],32)])),_:1},8,["theme"])}]])},9827:(t,e,a)=>{a.d(e,{A:()=>d});var s=a(7413);const d={data:()=>({darkTheme:s.a}),methods:{getTheme:t=>"dark"===t?s.a:null}}}}]);